(window.webpackJsonp=window.webpackJsonp||[]).push([[343],{718:function(s,t,a){"use strict";a.r(t);var p=a(5),n=Object(p.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"pm2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pm2"}},[s._v("#")]),s._v(" PM2")]),s._v(" "),t("p",[s._v("前面我们都是 node 直接跑的 Nest 应用，但生产环境我们不会直接跑 node，而会用 pm2 来跑。")]),s._v(" "),t("p",[s._v("为什么要用 pm2 呢？它解决了啥问题？")]),s._v(" "),t("p",[s._v("想一下：")]),s._v(" "),t("p",[s._v("如果你的 node 应用跑的时候突然抛了个错，崩溃了，是不是需要重新跑起来？")]),s._v(" "),t("p",[s._v("这时候是不是就需要另一个进程来自动做重启这件事情？")]),s._v(" "),t("p",[s._v("node 应用的日志默认输出在控制台，如果想输出到不同的日志文件，是不是可以让另一个进程获取 node 应用的输出，然后写文件来实现？")]),s._v(" "),t("p",[s._v("node 是单线程的，而机器是多个 cpu 的，为了充分利用 cpu 的能力，我们会用多个进程来跑 node 应用，这种通用逻辑是不是也可以放到一个单独进程里来实现？")]),s._v(" "),t("p",[s._v("node 运行时的 cpu、内存等资源的占用，是不是需要监控？这时候是不是可以让另一个进程来做？")]),s._v(" "),t("p",[s._v("线上的 node 应用不只是跑起来就行了，还要做自动重启、日志、多进程、监控这些事情。")]),s._v(" "),t("p",[s._v("而这些事情，都可以用 pm2 来做。")]),s._v(" "),t("p",[s._v("pm2 是 process manager，进程管理，它是第二个大版本，和前一个版本差异很大，所以叫 pm2.")]),s._v(" "),t("p",[s._v("pm2 的主要功能就是"),t("strong",[s._v("进程管理、日志管理、负载均衡、性能监控")]),s._v("这些。")]),s._v(" "),t("p",[s._v("我们分别来看一下：")]),s._v(" "),t("p",[s._v("首先安装 pm2:")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("npm install -g pm2\n")])])]),t("p",[s._v("然后跑一个 node 应用，我这里跑一个 Nest 的应用：")]),s._v(" "),t("p",[s._v("直接 node 跑是这样的，日志打印在控制台：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/wE8FaD3vY7B4Gdz.png",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"而用-pm2-的话-就可以这样跑"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#而用-pm2-的话-就可以这样跑"}},[s._v("#")]),s._v(" 而用 pm2 的话，就可以这样跑：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("pm2 start ./dist/main.js\n")])])]),t("p",[s._v("它会把这个 node 进程跑起来，然后管理起来：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/B95YMAwJONWa8Re.png",alt:""}})]),s._v(" "),t("p",[s._v("管理起来之后，就有我们上面说的那些功能了，比如自动重启、日志管理、性能监控等。")]),s._v(" "),t("h2",{attrs:{id:"首先看下日志-执行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#首先看下日志-执行"}},[s._v("#")]),s._v(" 首先看下日志，执行")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("pm2 logs\n")])])]),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/5CYUsapvEcHVdXl.png",alt:"i"}})]),s._v(" "),t("p",[s._v("可以看到 pm2 会把所有进程的日志打印出来，通过前面的“进程 id|进程名字”来区分，比如 0|main。")]),s._v(" "),t("p",[s._v("而且，它会把它写到日志文件里，在 ~/.pm2/logs 下，以“进程名-out.log”和“进程名-error.log”分别保存不同进程的日志：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/KU3xXpiYyNC1DZs.png",alt:""}})]),s._v(" "),t("p",[s._v("比如 main-out.log 里保存了 main 进程的正常日志，而 main-error.log 里保存了它的报错日志：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/FZjLSfeazNpJslu.png",alt:""}})]),s._v(" "),t("p",[s._v("我们再跑一个进程试试：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/AFYWVqe6I5QHRBc.png",alt:""}})]),s._v(" "),t("p",[s._v("现在有两个进程了，pm2 logs 可以看到这两个进程的日志：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/ucVfU8Nbg9XZYK3.png",alt:""}})]),s._v(" "),t("p",[s._v("也可以")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("pm2 logs 进程名\npm2 logs 进程id\n")])])]),t("p",[s._v("这样查看单个进程的日志：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/oNdkVRIAn7i3qrK.png",alt:""}})]),s._v(" "),t("p",[s._v("这就是 pm2 的日志管理的功能。")]),s._v(" "),t("h2",{attrs:{id:"进程管理的话就是可以手动启动、重启、停止某个进程-而且崩溃了会自动重启-也可以定时自动重启。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进程管理的话就是可以手动启动、重启、停止某个进程-而且崩溃了会自动重启-也可以定时自动重启。"}},[s._v("#")]),s._v(" 进程管理的话就是可以手动启动、重启、停止某个进程，而且崩溃了会自动重启，也可以定时自动重启。")]),s._v(" "),t("p",[s._v("只需要 pm2 start 的时候带上几个选项就好了：")]),s._v(" "),t("p",[s._v("超过 200M 内存自动重启：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("pm2 start xxx --max-memory-restart 200M\n")])])]),t("p",[s._v("从 2s 开始每 3s 重启一次：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v('pm2 start xxx --cron-restart "2/3 * * * * *"\n')])])]),t("p",[s._v("当文件内容改变自动重启：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("pm2 start xxx --watch\n")])])]),t("p",[s._v("不自动重启：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("pm2 start xxx --no-autorestart\n")])])]),t("p",[s._v("我们分别试一下：")]),s._v(" "),t("p",[s._v("把之前的进程删掉：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("pm2 delete 0\n")])])]),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/AhuS3UFI5dRp1Jm.png",alt:""}})]),s._v(" "),t("p",[s._v("我们指定 1k 内存就重启：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("pm2 start xxx --max-memory-restart 1K\n")])])]),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/hFzWZop3gJGldUk.png",alt:""}})]),s._v(" "),t("p",[s._v("然后在 nest 代码里用超过 1k 的内存：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/XJFQWCtEVro7TPw.png",alt:""}})]),s._v(" "),t("p",[s._v("先把之前的日志清空，使用 pm2 flush 或者 pm2 flush 进程名|id")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/gMBHAm5KrEyWSaD.png",alt:""}})]),s._v(" "),t("p",[s._v("确实清空了：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/Njk17ytXCZAhKQI.png",alt:""}})]),s._v(" "),t("p",[s._v("访问下这个 controller：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/KSjAQ6irpGxzqmW.png",alt:""}})]),s._v(" "),t("p",[s._v("查看 main 进程的前 100 行日志：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("pm2 logs main --lines 100\n")])])]),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/GvVSmQRxlwXLYpI.png",alt:""}})]),s._v(" "),t("p",[s._v("明显看到重启了。")]),s._v(" "),t("p",[s._v("这是超过内存的自动重启。")]),s._v(" "),t("p",[s._v("崩溃的自动重启、定时自动重启、文件变动自动重启等也是类似 。")]),s._v(" "),t("p",[s._v("我们前面用到的 pm2 start、pm2 stop、pm2 restart、pm2 delete 等就是进程管理的功能。")]),s._v(" "),t("p",[s._v("再就是负载均衡，node 应用是单进程的，而为了充分利用多核 cpu，我们会使用多进程来提高性能。")]),s._v(" "),t("p",[s._v("node 提供的 cluster 模块就是做这个的，pm2 就是基于这个实现了负载均衡。")]),s._v(" "),t("p",[s._v("我们只要启动进程的时候加上 -i num 就是启动 num 个进程做负载均衡的意思。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("pm2 start app.js -i max\npm2 start app.js -i 0\n")])])]),t("p",[s._v("这俩是启动 cpu 数量的进程。")]),s._v(" "),t("h2",{attrs:{id:"用多进程的方式跑-nest-应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用多进程的方式跑-nest-应用"}},[s._v("#")]),s._v(" 用多进程的方式跑 nest 应用：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/6m83jPKigtZOxHh.png",alt:""}})]),s._v(" "),t("p",[s._v("可以看到启动了 8 个进程，因为我是 8 核 cpu。")]),s._v(" "),t("p",[s._v("跑起来之后，还可以动态调整进程数，通过 pm2 scale：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("pm2 scale main 3\n")])])]),t("p",[s._v("我把 main 的集群调整为 3 个进程：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/YtS24wis9L7ZrnC.png",alt:""}})]),s._v(" "),t("p",[s._v("可以看到 pm2 删除了 5 个，留下了 3 个。")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("pm2 scale main +3\n")])])]),t("p",[s._v("我又加了 3 个，现在变成了 6 个：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/iwqB8lyRtAEIJYZ.png",alt:""}})]),s._v(" "),t("p",[s._v("可以动态伸缩进程的数量，pm2 会把请求分配到不同进程上去。")]),s._v(" "),t("p",[s._v("这就是负载均衡功能。")]),s._v(" "),t("h2",{attrs:{id:"此外-还有个性能监控功能-执行-pm2-monit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#此外-还有个性能监控功能-执行-pm2-monit"}},[s._v("#")]),s._v(" 此外，还有个性能监控功能，执行 pm2 monit:")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("pm2 monit\n")])])]),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/jnZ4xRpgwOiT9QF.gif",alt:""}})]),s._v(" "),t("p",[s._v("可以看到不同进程的 cpu 和内存占用情况。")]),s._v(" "),t("p",[s._v("大概就是这些功能，但是当进程多了之后，难道都要手动通过命令行来启动么？")]),s._v(" "),t("p",[s._v("肯定不会每次都敲一遍。")]),s._v(" "),t("h2",{attrs:{id:"pm2-支持配置文件的方式启动多个应用。"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pm2-支持配置文件的方式启动多个应用。"}},[s._v("#")]),s._v(" pm2 支持配置文件的方式启动多个应用。")]),s._v(" "),t("p",[s._v("执行 pm2 ecosystem，会创建一个配置文件：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/kb8xmPiCSvEz4Zq.png",alt:""}})]),s._v(" "),t("p",[s._v("apps 部分就是配置应用的，scripts 就是应用的启动路径：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/BMClpQkSND8Fwjo.png",alt:""}})]),s._v(" "),t("p",[s._v("它可以指定的配置非常多，基本就是命令行有啥选项，这里就有啥属性：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/Yq9zRwHebiTapWy.png",alt:""}})]),s._v(" "),t("p",[s._v("然后 pm2 start ecosystem.config.js 就可以批量跑一批应用。")]),s._v(" "),t("p",[s._v("就相当于 pm2 根据配置文件自动执行这些命令，不用我们手动敲了。")]),s._v(" "),t("p",[s._v("这样，我们就可以把启动的选项保存在配置文件里。")]),s._v(" "),t("p",[s._v("最后，还有个 pm2 plus，这个是收费功能，看看就行：")]),s._v(" "),t("p",[s._v("访问 pm2 的网站，登录，创建 bucket：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/8mUwcCHyEtJ6joK.png",alt:""}})]),s._v(" "),t("p",[s._v("然后在本地执行 pm2 link xxx xxx，把本地的 pm2 和那个网站关联起来：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/8gtZPyG2jIYKi5N.png",alt:""}})]),s._v(" "),t("p",[s._v("再执行 pm2 plus 就会打开 bucket 对应的网页：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/MinyJABTfjXs5Cb.png",alt:""}})]),s._v(" "),t("p",[s._v("可以在线监控你的应用：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/l39iPkwujtnq7QF.png",alt:""}})]),s._v(" "),t("p",[s._v("下面这些 plus 的功能都是收费的：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/lhEGbVvnDeLuaKk.png",alt:""}})]),s._v(" "),t("p",[s._v("一般也不需要用，用免费的本地功能就好了。")]),s._v(" "),t("h2",{attrs:{id:"有同学说-不都是-docker-部署了么-还需要-pm2-么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#有同学说-不都是-docker-部署了么-还需要-pm2-么"}},[s._v("#")]),s._v(" 有同学说，不都是 docker 部署了么？还需要 pm2 么？")]),s._v(" "),t("p",[s._v("当然需要了，万一 docker 容器内 node 服务崩溃了，是不是需要重启？")]),s._v(" "),t("p",[s._v("docker 容器内的进程同样有日志管理、进程管理和监控的需求。")]),s._v(" "),t("p",[s._v("一般都是 "),t("a",{attrs:{href:"https://github.com/Unitech/pm2/blob/master/examples/docker-pm2/Dockerfile",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker 镜像"),t("OutboundLink")],1),s._v("内安装 pm2 来跑 node：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/cOEruzRHiTGQoCM.png",alt:""}})]),s._v(" "),t("p",[s._v("之前我们写的 Nest 的 dockerfile 是这样的：")]),s._v(" "),t("div",{staticClass:"language-docker line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-docker"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# build stage")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:18 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" build-stage")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" package.json .")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm config set registry https://registry.npmmirror.com/")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm install")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm run build")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# production stage")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:18 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" production-stage")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("build-stage")])]),s._v(" /app/dist /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token options"}},[t("span",{pre:!0,attrs:{class:"token property"}},[s._v("--from")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("build-stage")])]),s._v(" /app/package.json /app/package.json")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm install --production")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 3000")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app/main.js"')]),s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[s._v("现在要改成这样：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/vGyE3M6fPNiZzAV.png",alt:""}})]),s._v(" "),t("p",[s._v("就是多装一个 pm2，然后用 pm2 代替 node 来跑。")]),s._v(" "),t("p",[s._v("我们 docker build 一下：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("docker build -t nest:ccc .\n")])])]),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/64vJRzoENaO1mSd.png",alt:""}})]),s._v(" "),t("p",[s._v("把它跑起来：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/2ST8Mce1Y9us5gE.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/GeOnBcxIRpXrowa.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/AM492Vua8zhLiZy.png",alt:""}})]),s._v(" "),t("p",[s._v("这个就是 pm2 打印的日志。")]),s._v(" "),t("p",[s._v("你可以在 terminal 使用 pm2 的命令：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://s2.loli.net/2025/05/30/q9X5cYsPoNtTymK.png",alt:""}})]),s._v(" "),t("p",[s._v("现在这个容器内的 node 进程在崩溃时就会自动重启。")]),s._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),t("p",[s._v("服务器上的 node 应用需要用 pm2 的日志管理、进程管理、负载均衡、性能监控等功能。")]),s._v(" "),t("p",[s._v("分别对应 pm2 logs、pm2 start/restart/stop/delete、pm2 start -i、pm2 monit 等命令。")]),s._v(" "),t("p",[s._v("多个应用或者想把启动选项保存下来的时候，可以通过 ecosystem 配置文件，批量启动一系列应用。")]),s._v(" "),t("p",[s._v("我们会把 docker 和 pm2 结合起来，在进程崩溃的时候让 pm2 来自动重启。")]),s._v(" "),t("p",[s._v("只要写 dockerfile 的时候多安装一个 pm2 的依赖，然后把 node 换成 pm2-runtime 就好了。")]),s._v(" "),t("p",[s._v("不管是出于稳定性、性能还是可观测性等目的，pm2 都是必不可少的。")])])}),[],!1,null,null,null);t.default=n.exports}}]);