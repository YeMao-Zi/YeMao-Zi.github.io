(window.webpackJsonp=window.webpackJsonp||[]).push([[225],{601:function(t,s,a){"use strict";a.r(s);var n=a(5),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("Nest 的功能都是大多通过装饰器来使用的，这节我们就把所有的装饰器过一遍。")]),t._v(" "),s("p",[t._v("我们创建个新的 nest 项目：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v("nest new all-decorator -p npm\n")])])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/hMml3bJI9W5XOtQ.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"module"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#module"}},[t._v("#")]),t._v(" @Module")]),t._v(" "),s("p",[t._v("Nest 提供了一套模块系统，通过 @Module声明模块：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/j5XbR9I1vCgmTMs.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"controller、-injectable"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#controller、-injectable"}},[t._v("#")]),t._v(" @Controller、@Injectable")]),t._v(" "),s("p",[t._v("通过 @Controller、@Injectable 分别声明其中的 controller 和 provider：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/cL13IKhGmEjZYSR.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/SLyqD6rxwMJtv4k.png",alt:""}})]),t._v(" "),s("p",[t._v("这个 provider 可以是任何的 class：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/lWzmIYP3NeRMaAJ.png",alt:""}})]),t._v(" "),s("p",[t._v("注入的方式可以是构造器注入：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/cHfDuli2B4AstN8.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"inject"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#inject"}},[t._v("#")]),t._v(" @Inject")]),t._v(" "),s("p",[t._v("或者属性注入：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/qJiBGb1WVcylFto.png",alt:""}})]),t._v(" "),s("p",[t._v("属性注入要指定注入的 token，可能是 class 也可能是 string。")]),t._v(" "),s("p",[t._v("你可以通过 useFactory、useValue 等方式声明 provider：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/zdsrDtaNxKbJFpX.png",alt:""}})]),t._v(" "),s("p",[t._v("这时候也需要通过 @Inject 指定注入的 token：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/EckIQid6vKxN2Tq.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/wZHuRqmra8YiMB4.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"options"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#options"}},[t._v("#")]),t._v(" @Options")]),t._v(" "),s("p",[t._v("这些注入的依赖如果没有的话，创建对象时会报错。但如果它是可选的，你可以用 @Optional 声明一下，这样没有对应的 provider 也能正常创建这个对象。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/5XmPMd4zGjODkHS.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"global"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#global"}},[t._v("#")]),t._v(" @Global")]),t._v(" "),s("p",[t._v("如果模块被很多地方都引用，为了方便，可以用 @Global 把它声明为全局的，这样它 exports 的 provider 就可以直接注入了：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/AHtDhX4BEYizLC5.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"catch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#catch"}},[t._v("#")]),t._v(" @Catch")]),t._v(" "),s("p",[t._v("filter 是处理抛出的未捕获异常的，通过 @Catch 来指定处理的异常：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/LAlyUzSHnB2WFOt.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"usefilters"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#usefilters"}},[t._v("#")]),t._v(" @UseFilters")]),t._v(" "),s("p",[t._v("然后通过 @UseFilters 应用到 handler 上：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/FhlZ6iGNAIRoj1t.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/34LtxnmVZCbJyPa.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"usefilters、-useguards、-useinterceptors、-usepipes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#usefilters、-useguards、-useinterceptors、-usepipes"}},[t._v("#")]),t._v(" @UseFilters、@UseGUards、@UseInterceptors、@UsePipes")]),t._v(" "),s("p",[t._v("除了 filter 之外，interceptor、guard、pipe 也是这样用：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/gqpnczdiSsb8BWD.png",alt:""}})]),t._v(" "),s("p",[t._v("当然，pipe 更多还是单独在某个参数的位置应用：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/XC2noGE5BUJjxle.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"获取参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取参数"}},[t._v("#")]),t._v(" 获取参数")]),t._v(" "),s("h3",{attrs:{id:"param、-query"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#param、-query"}},[t._v("#")]),t._v(" @Param、@Query")]),t._v(" "),s("p",[t._v("这里的 @Query 是取 url 后的 ?bbb=true，而 @Param 是取路径中的参数，比如 /xxx/111 种的 111")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/oGV9cki5RqCy7BO.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/oC4YbvyQlGUJ3nL.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"body"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#body"}},[t._v("#")]),t._v(" @Body")]),t._v(" "),s("p",[t._v("此外，如果是 @Post 请求，可以通过 @Body 取到 body 部分：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/gPEe82LKSfhk4iq.png",alt:""}})]),t._v(" "),s("p",[t._v("我们一般用 dto 的 class 来接受请求体里的参数：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/x8kP2AFK9gnLvIZ.png",alt:""}})]),t._v(" "),s("p",[t._v("nest 会实例化一个 dto 对象：")]),t._v(" "),s("p",[t._v("用 postman 发个 post 请求：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/wurCBVi92t1bJW8.png",alt:""}})]),t._v(" "),s("p",[t._v("可以看到 nest 接受到了 body 里的参数：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/5ZacW3I28NFrbp6.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"get、-post-请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#get、-post-请求"}},[t._v("#")]),t._v(" @Get、@Post...请求")]),t._v(" "),s("p",[t._v("除了 @Get、@Post 外，还可以用 @Put、@Delete、@Patch、@Options、@Head 装饰器分别接受 put、delete、patch、options、head 请求：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/aMjyHqJinSsEKwZ.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"setmetadata"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#setmetadata"}},[t._v("#")]),t._v(" @SetMetadata")]),t._v(" "),s("p",[t._v("handler 和 class 可以通过 @SetMetadata 指定 metadata：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/qoG85dFIbMnCWJQ.png",alt:""}})]),t._v(" "),s("p",[t._v("然后在 guard 或者 interceptor 里取出来：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/3IrCETVtqxfWSHD.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/AIlOXcDzGPqvwJL.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"headers"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#headers"}},[t._v("#")]),t._v(" @Headers")]),t._v(" "),s("p",[t._v("你可以通过 @Headers 装饰器取某个请求头 或者全部请求头：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/ypfPQmuq6YXviIe.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/9N7lctnQvFTHBPS.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"ip"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ip"}},[t._v("#")]),t._v(" @Ip")]),t._v(" "),s("p",[t._v("通过 @Ip 拿到请求的 ip：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/ZCgET1OvUmcBLje.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"session"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#session"}},[t._v("#")]),t._v(" @Session")]),t._v(" "),s("p",[t._v("通过 @Session 拿到 session 对象：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/MqPRarXjIbGNzvT.png",alt:""}})]),t._v(" "),s("p",[t._v("但要使用 session 需要安装一个 express 中间件：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v("npm install express-session\n")])])]),s("p",[t._v("在 main.ts 里引入并启用：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/LtqXmO1IEHfAowc.png",alt:""}})]),t._v(" "),s("p",[t._v("指定加密的密钥和 cookie 的存活时间。")]),t._v(" "),s("p",[t._v("然后刷新页面：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/gOcCdWfiGNUxst8.png",alt:""}})]),t._v(" "),s("p",[t._v("会返回 set-cookie 的响应头，设置了 cookie，包含 sid 也就是 sesssionid。")]),t._v(" "),s("p",[t._v("之后每次请求都会自动带上这个 cookie：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/TAQ46sZ3chUz9Re.png",alt:""}})]),t._v(" "),s("p",[t._v("这样就可以在 session 对象里存储信息了。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/MLgif7sT9HReyob.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/kwZYjsPFJmuUt9d.gif",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"hostparam"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hostparam"}},[t._v("#")]),t._v(" @HostParam")]),t._v(" "),s("p",[t._v("@HostParam 用于取域名部分的参数：")]),t._v(" "),s("p",[t._v("我们再创建个 controller：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v("nest g controller aaa --no-spec --flat\n")])])]),s("p",[s("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a30b153d260842c4b0a21aa9ab37bd46~tplv-k3u1fbpfcp-watermark.image?",alt:""}})]),t._v(" "),s("p",[t._v("这样指定 controller 的生效路径：")]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Controller"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HostParam "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@nestjs/common'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n@"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Controller")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("':host.0.0.1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'aaa'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AaaController")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    @"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bbb'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("hello")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("p",[t._v("controller 除了可以指定某些 path 生效外，还可以指定 host：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/XWSNd8rvgUAxHnk.png",alt:""}})]),t._v(" "),s("p",[t._v("然后再访问下：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/rYSBlvMZymzsjWn.gif",alt:""}})]),t._v(" "),s("p",[t._v("这时候你会发现只有 host 满足 xx.0.0.1 的时候才会路由到这个 controller。")]),t._v(" "),s("p",[t._v("host 里的参数就可以通过 @HostParam 取出来：")]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Controller"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Get"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" HostParam "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@nestjs/common'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n@"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Controller")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("':host.0.0.1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("path")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'aaa'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AaaController")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    @"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bbb'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("hello")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("@"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("HostParam")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'host'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/UfV3gov8E7ysu46.gif",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"req、-request"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#req、-request"}},[t._v("#")]),t._v(" @Req、@Request")]),t._v(" "),s("p",[t._v("前面取的这些都是 request 里的属性，当然也可以直接注入 request 对象：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/dDSujWw2gEkoIhp.png",alt:""}})]),t._v(" "),s("p",[t._v("通过 @Req 或者 @Request 装饰器，这俩是同一个东西：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/pMFbKy2e8rQh9SR.png",alt:""}})]),t._v(" "),s("p",[t._v("注入 request 对象后，可以手动取任何参数：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/WN8GPABnTpx2X7s.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"res、-response"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#res、-response"}},[t._v("#")]),t._v(" @Res、@Response")]),t._v(" "),s("p",[t._v("当然，也可以 @Res 或者 @Response 注入 response 对象，只不过 response 对象有点特殊：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/ecxR1lquOSU2yPG.png",alt:""}})]),t._v(" "),s("p",[t._v("当你注入 response 对象之后，服务器会一直没有响应：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/JmEnrpyg4hiNkWS.png",alt:""}})]),t._v(" "),s("p",[t._v("因为这时候 Nest 就不会再把 handler 返回值作为响应内容了。")]),t._v(" "),s("p",[t._v("你可以自己返回响应：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/Exs7OL5aFeAvGVk.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/Uzq6T8jKlGVaoEI.png",alt:""}})]),t._v(" "),s("p",[t._v("Nest 这么设计是为了避免你自己返回的响应和 Nest 返回的响应的冲突。")]),t._v(" "),s("p",[t._v("如果你不会自己返回响应，可以通过 passthrough 参数告诉 Nest：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/VHjmx5WnzuGeTAK.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/Uzq6T8jKlGVaoEI.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"next"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#next"}},[t._v("#")]),t._v(" @Next")]),t._v(" "),s("p",[t._v("除了注入 @Res 不会返回响应外，注入 @Next 也不会：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/m2zFMLfWRdvxtwU.png",alt:""}})]),t._v(" "),s("p",[t._v("当你有两个 handler 来处理同一个路由的时候，可以在第一个 handler 里注入 next，调用它来把请求转发到第二个 handler：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/H7rhMRAIN9SekDz.png",alt:""}})]),t._v(" "),s("p",[t._v("Nest 不会处理注入 @Next 的 handler 的返回值。")]),t._v(" "),s("h2",{attrs:{id:"httpcode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#httpcode"}},[t._v("#")]),t._v(" @HttpCode")]),t._v(" "),s("p",[t._v("handler 默认返回的是 200 的状态码，你可以通过 @HttpCode 修改它：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/HaeFU9B1LkoZWqP.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/ysEW2AHITXJPt3R.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"header"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#header"}},[t._v("#")]),t._v(" @Header")]),t._v(" "),s("p",[t._v("当然，你也可以修改 response header，通过 @Header 装饰器：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/Bf8dZo2NO4FgKSh.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/WDXS1YZKwLaqvoc.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"redirect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redirect"}},[t._v("#")]),t._v(" @Redirect")]),t._v(" "),s("p",[t._v("此外，你还可以通过 @Redirect 装饰器来指定路由重定向的 url：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/KlsRrFj7YyEGZ9L.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/4njESRZ73QKpc2r.gif",alt:""}})]),t._v(" "),s("p",[t._v("或者在返回值的地方设置 url：")]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("@"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxx'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n@"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Redirect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("jump")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("url")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://www.baidu.com'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("statusCode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("302")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[t._v("你还可以给返回的响应内容指定渲染引擎，不过这需要先这样设置：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/Sk5BZrgPIilQK4q.png",alt:""}})]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" NestFactory "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@nestjs/core'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" AppModule "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./app.module'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" NestExpressApplication "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@nestjs/platform-express'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" join "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bootstrap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" NestFactory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("NestExpressApplication"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("AppModule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useStaticAssets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'..'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'public'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setBaseViewsDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'..'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'views'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setViewEngine")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hbs'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bootstrap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br")])]),s("p",[t._v("分别指定静态资源的路径和模版的路径，并指定模版引擎为 handlerbars。")]),t._v(" "),s("p",[t._v("当然，还需要安装模版引擎的包 hbs：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v("npm install --save hbs\n")])])]),s("p",[t._v("然后准备图片和模版文件：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/k9t2zPNBaUOeH4R.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/mXefAJiPzCg4M9Q.png",alt:""}})]),t._v(" "),s("p",[t._v("在 handler 里指定模版和数据：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/MBdcZGnIeKyDEWX.png",alt:""}})]),t._v(" "),s("p",[t._v("就可以看到渲染出的 html 了：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/03/19/YsLSXRQ127JEfrH.png",alt:""}})]),t._v(" "),s("p",[t._v("案例代码在"),s("a",{attrs:{href:"https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/all-decorator",target:"_blank",rel:"noopener noreferrer"}},[t._v("小册仓库"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("这节我们梳理了下 Nest 全部的装饰器")]),t._v(" "),s("ul",[s("li",[t._v("@Module： 声明 Nest 模块")]),t._v(" "),s("li",[t._v("@Controller：声明模块里的 controller")]),t._v(" "),s("li",[t._v("@Injectable：声明模块里可以注入的 provider")]),t._v(" "),s("li",[t._v("@Inject：通过 token 手动指定注入的 provider，token 可以是 class 或者 string")]),t._v(" "),s("li",[t._v("@Optional：声明注入的 provider 是可选的，可以为空")]),t._v(" "),s("li",[t._v("@Global：声明全局模块")]),t._v(" "),s("li",[t._v("@Catch：声明 exception filter 处理的 exception 类型")]),t._v(" "),s("li",[t._v("@UseFilters：路由级别使用 exception filter")]),t._v(" "),s("li",[t._v("@UsePipes：路由级别使用 pipe")]),t._v(" "),s("li",[t._v("@UseInterceptors：路由级别使用 interceptor")]),t._v(" "),s("li",[t._v("@SetMetadata：在 class 或者 handler 上添加 metadata")]),t._v(" "),s("li",[t._v("@Get、@Post、@Put、@Delete、@Patch、@Options、@Head：声明 get、post、put、delete、patch、options、head 的请求方式")]),t._v(" "),s("li",[t._v("@Param：取出 url 中的参数，比如 /aaa/:id 中的 id")]),t._v(" "),s("li",[t._v("@Query: 取出 query 部分的参数，比如 /aaa?name=xx 中的 name")]),t._v(" "),s("li",[t._v("@Body：取出请求 body，通过 dto class 来接收")]),t._v(" "),s("li",[t._v("@Headers：取出某个或全部请求头")]),t._v(" "),s("li",[t._v("@Session：取出 session 对象，需要启用 express-session 中间件")]),t._v(" "),s("li",[t._v("@HostParm： 取出 host 里的参数")]),t._v(" "),s("li",[t._v("@Req、@Request：注入 request 对象")]),t._v(" "),s("li",[t._v("@Res、@Response：注入 response 对象，一旦注入了这个 Nest 就不会把返回值作为响应了，除非指定 passthrough 为true")]),t._v(" "),s("li",[t._v("@Next：注入调用下一个 handler 的 next 方法")]),t._v(" "),s("li",[t._v("@HttpCode： 修改响应的状态码")]),t._v(" "),s("li",[t._v("@Header：修改响应头")]),t._v(" "),s("li",[t._v("@Redirect：指定重定向的 url")]),t._v(" "),s("li",[t._v("@Render：指定渲染用的模版引擎")])]),t._v(" "),s("p",[t._v("把这些装饰器用熟，就掌握了 nest 大部分功能了。")])])}),[],!1,null,null,null);s.default=e.exports}}]);