(window.webpackJsonp=window.webpackJsonp||[]).push([[298],{675:function(_,v,t){"use strict";t.r(v);var d=t(5),e=Object(d.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("p",[_._v("上节梳理了需求，画了原型图，这节来设计下技术方案。")]),_._v(" "),v("h2",{attrs:{id:"技术栈"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#技术栈"}},[_._v("#")]),_._v(" 技术栈")]),_._v(" "),v("p",[_._v("前端部分还是 React + Antd Design，脚手架用 create-vite：")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d0beaf880b4a4ffe8e1ef36e9270582f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1586&h=1048&s=265463&e=png&b=ffffff",alt:""}})]),_._v(" "),v("p",[_._v("后端部分是 Nest + Prisma + Socket.io。")]),_._v(" "),v("p",[_._v("Prisma 是 ORM 框架，Socket.io 用来做 WebSocket 通信。")]),_._v(" "),v("p",[_._v("数据库是 mysql + redis，mysql 做持久化存储，redis 做缓存以及临时数据的存储。")]),_._v(" "),v("p",[_._v("用 minio 做 OSS 对象存储服务，存储上传的文件。")]),_._v(" "),v("p",[_._v("文档用 swagger 生成，部署用 docker compose + pm2。")]),_._v(" "),v("h2",{attrs:{id:"数据库设计"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#数据库设计"}},[_._v("#")]),_._v(" 数据库设计")]),_._v(" "),v("p",[_._v("然后来设计下数据库表：")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1dfdb2067179481fb8ef946ce9285386~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1354&h=728&s=92122&e=png&b=fefefe",alt:""}})]),_._v(" "),v("p",[_._v("需要这些表。")]),_._v(" "),v("p",[_._v("用户表存储用户信息，好友关系表就是存储用户和用户的关联关系。")]),_._v(" "),v("p",[_._v("好友申请表存储用户对用户的好友申请的记录。")]),_._v(" "),v("p",[_._v("聊天室表存储聊天室的信息。")]),_._v(" "),v("p",[_._v("用户所在聊天室表存储用户和聊天室的关联。")]),_._v(" "),v("p",[_._v("聊天记录表存储持久化的聊天记录。")]),_._v(" "),v("p",[_._v("收藏表存储用户收藏的聊天记录。")]),_._v(" "),v("p",[_._v("详细设计如下：")]),_._v(" "),v("p",[_._v("用户表 users：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("用户ID")])]),_._v(" "),v("tr",[v("td",[_._v("username")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("用户名")])]),_._v(" "),v("tr",[v("td",[_._v("password")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("密码")])]),_._v(" "),v("tr",[v("td",[_._v("nick_name")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("昵称")])]),_._v(" "),v("tr",[v("td",[_._v("email")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("邮箱")])]),_._v(" "),v("tr",[v("td",[_._v("head_pic")]),_._v(" "),v("td",[_._v("VARCHAR(100)")]),_._v(" "),v("td",[_._v("头像")])]),_._v(" "),v("tr",[v("td",[_._v("create_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("创建时间")])]),_._v(" "),v("tr",[v("td",[_._v("update_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("更新时间")])])])]),_._v(" "),v("p",[_._v("好友关系表 friendship：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("user1_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("用户1")])]),_._v(" "),v("tr",[v("td",[_._v("user2_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("用户2")])])])]),_._v(" "),v("p",[_._v("聊天室表 chatroom：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("聊天室ID")])]),_._v(" "),v("tr",[v("td",[_._v("name")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("群聊名")])]),_._v(" "),v("tr",[v("td",[_._v("type")]),_._v(" "),v("td",[_._v("BOOLEAN")]),_._v(" "),v("td",[_._v("类型（单聊、群聊）")])]),_._v(" "),v("tr",[v("td",[_._v("create_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("创建时间")])]),_._v(" "),v("tr",[v("td",[_._v("update_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("更新时间")])])])]),_._v(" "),v("p",[_._v("用户所在聊天室表 user_chatroom：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("user_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("用户ID")])]),_._v(" "),v("tr",[v("td",[_._v("chatroom_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("聊天室ID")])])])]),_._v(" "),v("p",[_._v("聊天记录表 chat_history：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("聊天记录ID")])]),_._v(" "),v("tr",[v("td",[_._v("content")]),_._v(" "),v("td",[_._v("VARCHAR(500)")]),_._v(" "),v("td",[_._v("聊天内容")])]),_._v(" "),v("tr",[v("td",[_._v("chatroom_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("聊天室ID")])]),_._v(" "),v("tr",[v("td",[_._v("sender_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("发送者ID")])]),_._v(" "),v("tr",[v("td",[_._v("send_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("发送时间")])]),_._v(" "),v("tr",[v("td",[_._v("update_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("更新时间")])])])]),_._v(" "),v("p",[_._v("好友申请表 friend_request：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("好友申请id")])]),_._v(" "),v("tr",[v("td",[_._v("from_user_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("发送方")])]),_._v(" "),v("tr",[v("td",[_._v("to_user_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("待添加好友")])]),_._v(" "),v("tr",[v("td",[_._v("reason")]),_._v(" "),v("td",[_._v("VARCHAR(100)")]),_._v(" "),v("td",[_._v("添加理由")])]),_._v(" "),v("tr",[v("td",[_._v("status")]),_._v(" "),v("td",[_._v("VARCHAR(10)")]),_._v(" "),v("td",[_._v("状态（待处理、已同意、已拒绝）")])]),_._v(" "),v("tr",[v("td",[_._v("create_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("创建时间")])]),_._v(" "),v("tr",[v("td",[_._v("update_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("更新时间")])])])]),_._v(" "),v("p",[_._v("收藏表 favorite：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("ID")])]),_._v(" "),v("tr",[v("td",[_._v("user_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("用户 ID")])]),_._v(" "),v("tr",[v("td",[_._v("chat_history_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("聊天记录ID")])]),_._v(" "),v("tr",[v("td",[_._v("create_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("创建时间")])]),_._v(" "),v("tr",[v("td",[_._v("update_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("更新时间")])])])]),_._v(" "),v("p",[_._v("然后划分下模块：")]),_._v(" "),v("h2",{attrs:{id:"模块划分"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#模块划分"}},[_._v("#")]),_._v(" 模块划分")]),_._v(" "),v("p",[_._v("首先是用户模块，实现登录、注册、信息修改的功能：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("接口路径")]),_._v(" "),v("th",[_._v("请求方式")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("/user/login")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("用户登录")])]),_._v(" "),v("tr",[v("td",[_._v("/user/register")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("用户注册")])]),_._v(" "),v("tr",[v("td",[_._v("/user/update")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("用户个人信息修改")])]),_._v(" "),v("tr",[v("td",[_._v("/user/update_password")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("用户修改密码")])])])]),_._v(" "),v("p",[_._v("好友管理模块：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("接口路径")]),_._v(" "),v("th",[_._v("请求方式")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("/friendship/add")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("添加好友")])]),_._v(" "),v("tr",[v("td",[_._v("/friendship/delete")]),_._v(" "),v("td",[_._v("DELETE")]),_._v(" "),v("td",[_._v("删除好友")])]),_._v(" "),v("tr",[v("td",[_._v("/friendship/list")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("好友列表")])])])]),_._v(" "),v("p",[_._v("聊天室管理模块：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("接口路径")]),_._v(" "),v("th",[_._v("请求方式")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("/chatroom/join")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("加入聊天室")])]),_._v(" "),v("tr",[v("td",[_._v("/chatroom/exit")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("退出聊天室")])]),_._v(" "),v("tr",[v("td",[_._v("/chatroom/list")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("聊天室列表")])]),_._v(" "),v("tr",[v("td",[_._v("/chatroom/add")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("新建聊天室（单聊、群聊）")])])])]),_._v(" "),v("p",[_._v("聊天模块：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("接口路径")]),_._v(" "),v("th",[_._v("请求方式")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("/chat")]),_._v(" "),v("td",[_._v("WEBSOCKET")]),_._v(" "),v("td",[_._v("聊天")])])])]),_._v(" "),v("p",[_._v("收藏管理模块：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("接口路径")]),_._v(" "),v("th",[_._v("请求方式")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("/favorite/add")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("添加收藏")])]),_._v(" "),v("tr",[v("td",[_._v("/favorite/delete")]),_._v(" "),v("td",[_._v("DELETE")]),_._v(" "),v("td",[_._v("删除收藏")])]),_._v(" "),v("tr",[v("td",[_._v("/favorite/list")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("收藏列表")])])])]),_._v(" "),v("p",[_._v("好友请求管理模块：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("接口路径")]),_._v(" "),v("th",[_._v("请求方式")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("/friend_request/list")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("好友请求列表")])]),_._v(" "),v("tr",[v("td",[_._v("/friend_request/agree")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("同意好友请求")])]),_._v(" "),v("tr",[v("td",[_._v("/friend_request/reject")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("拒绝好友请求")])])])]),_._v(" "),v("h2",{attrs:{id:"总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[_._v("#")]),_._v(" 总结")]),_._v(" "),v("p",[_._v("这节我们设计了下技术方案。")]),_._v(" "),v("p",[_._v("技术栈：前端是 antd + react + vite，后端是 nest + prisma + socket.io，数据库是 mysql + redis，对象存储用 minio，API 文档用 swagger 生成，部署用 docker compose + pm2，网关使用 nginx。")]),_._v(" "),v("p",[_._v("数据库表有 7 个：用户表 users、好友关系表 friendship、聊天室表 chatroom、用户所在聊天室表 user_chatroom、聊天记录表 chat_history、好友申请表 friend_request、收藏表 favorite。")]),_._v(" "),v("p",[_._v("模块有 6 个：用户模块、好友管理模块、聊天室管理模块、聊天模块、收藏管理模块、好友请求管理模块。")]),_._v(" "),v("p",[_._v("下节正式开始开发。")])])}),[],!1,null,null,null);v.default=e.exports}}]);