(window.webpackJsonp=window.webpackJsonp||[]).push([[276],{649:function(_,v,t){"use strict";t.r(v);var d=t(5),e=Object(d.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("p",[_._v("分析完需求，这节来设计下技术方案。")]),_._v(" "),v("h2",{attrs:{id:"技术栈"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#技术栈"}},[_._v("#")]),_._v(" 技术栈")]),_._v(" "),v("p",[_._v("前端部分 React + Antd Design，脚手架用 create-vite：")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fd0c914e3ae64d988e3f87e93abdcb35~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1470&h=850&s=211771&e=png&b=ffffff",alt:""}})]),_._v(" "),v("p",[_._v("后端服务是 Nest + Prisma，会拆分多个微服务，之间用 TCP 通信。")]),_._v(" "),v("p",[_._v("数据库是 mysql + redis，mysql 做持久化存储，redis 做缓存以及临时数据的存储。")]),_._v(" "),v("p",[_._v("用 minio 做 OSS 对象存储服务，存储上传的文件。")]),_._v(" "),v("p",[_._v("用 nacos 来做注册中心、配置中心，统一管理所有的配置、服务的地址注册。")]),_._v(" "),v("p",[_._v("rabbitmq 做消息队列，用于微服务之间的异步通信。")]),_._v(" "),v("p",[_._v("文档用 swagger 生成，部署用 docker compose。")]),_._v(" "),v("h2",{attrs:{id:"微服务拆分"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#微服务拆分"}},[_._v("#")]),_._v(" 微服务拆分")]),_._v(" "),v("p",[_._v("微服务的特点是可以独立开发、独立部署。")]),_._v(" "),v("p",[_._v("微服务之间通过 TCP 或者 gRPC 来做同步通信，通过消息队列来做异步通信。")]),_._v(" "),v("p",[_._v("我们之前分析出的四个模块，就可以拆分为 4 个微服务。")]),_._v(" "),v("p",[_._v("用户、考试、判卷、分析")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bb7f61f5550f4fe7953a9add03c84157~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1108&h=510&s=48303&e=png&b=ffffff",alt:""}})]),_._v(" "),v("p",[_._v("每个微服务都暴露 HTTP 接口出去，之间可以通过 TCP 来进行同步调用。")]),_._v(" "),v("p",[_._v("并且也可以通过 RabbitMQ 来做异步通信。")]),_._v(" "),v("p",[_._v("比如判卷完之后需要更新成绩排行榜，这时候就没必要同步生成，用消息队列通知分析微服务做异步生成就行。")]),_._v(" "),v("h2",{attrs:{id:"数据库设计"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#数据库设计"}},[_._v("#")]),_._v(" 数据库设计")]),_._v(" "),v("p",[_._v("然后来设计下数据库表：")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b174b0dd42a7426a8f5c622a0aa2df00~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=644&h=340&s=24775&e=png&b=ffffff",alt:""}})]),_._v(" "),v("p",[_._v("需要这三个表。")]),_._v(" "),v("p",[_._v("用户表存储用户信息。")]),_._v(" "),v("p",[_._v("考试表存储考试和试卷信息，关联着创建考试的用户，多对一关系。")]),_._v(" "),v("p",[_._v("答卷表存储用户的答卷，和考试表是多对一关系，和用户表也是多对一关系。")]),_._v(" "),v("p",[_._v("也就是说一个用户可以有多个答卷、一个考试可以有多个答卷，但一个答卷只能属于一个用户、一个考试。")]),_._v(" "),v("p",[_._v("详细设计如下：")]),_._v(" "),v("p",[_._v("用户表 user：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("用户ID")])]),_._v(" "),v("tr",[v("td",[_._v("username")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("用户名")])]),_._v(" "),v("tr",[v("td",[_._v("password")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("密码")])]),_._v(" "),v("tr",[v("td",[_._v("email")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("邮箱")])]),_._v(" "),v("tr",[v("td",[_._v("create_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("创建时间")])]),_._v(" "),v("tr",[v("td",[_._v("update_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("更新时间")])])])]),_._v(" "),v("p",[_._v("考试表 exam：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("考试ID")])]),_._v(" "),v("tr",[v("td",[_._v("createUserId")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("创建者ID")])]),_._v(" "),v("tr",[v("td",[_._v("name")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("考试名")])]),_._v(" "),v("tr",[v("td",[_._v("isPublish")]),_._v(" "),v("td",[_._v("BOOLEAN")]),_._v(" "),v("td",[_._v("是否发布")])]),_._v(" "),v("tr",[v("td",[_._v("isDelete")]),_._v(" "),v("td",[_._v("BOOLEAN")]),_._v(" "),v("td",[_._v("是否删除")])]),_._v(" "),v("tr",[v("td",[_._v("content")]),_._v(" "),v("td",[_._v("TEXT")]),_._v(" "),v("td",[_._v("试卷内容 JSON")])]),_._v(" "),v("tr",[v("td",[_._v("create_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("创建时间")])]),_._v(" "),v("tr",[v("td",[_._v("update_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("更新时间")])])])]),_._v(" "),v("p",[_._v("答卷表 answer：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("答卷ID")])]),_._v(" "),v("tr",[v("td",[_._v("answererId")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("答题人ID")])]),_._v(" "),v("tr",[v("td",[_._v("examId")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("答卷ID")])]),_._v(" "),v("tr",[v("td",[_._v("content")]),_._v(" "),v("td",[_._v("TEXT")]),_._v(" "),v("td",[_._v("答卷JSON")])]),_._v(" "),v("tr",[v("td",[_._v("score")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("分数")])]),_._v(" "),v("tr",[v("td",[_._v("create_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("创建时间")])]),_._v(" "),v("tr",[v("td",[_._v("update_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("更新时间")])])])]),_._v(" "),v("p",[_._v("然后划分下模块：")]),_._v(" "),v("h2",{attrs:{id:"模块划分"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#模块划分"}},[_._v("#")]),_._v(" 模块划分")]),_._v(" "),v("p",[_._v("首先是用户模块，实现登录、注册、修改密码的功能：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("接口路径")]),_._v(" "),v("th",[_._v("请求方式")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("/user/login")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("用户登录")])]),_._v(" "),v("tr",[v("td",[_._v("/user/register")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("用户注册")])]),_._v(" "),v("tr",[v("td",[_._v("/user/update_password")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("用户修改密码")])])])]),_._v(" "),v("p",[_._v("试卷模块：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("接口路径")]),_._v(" "),v("th",[_._v("请求方式")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("/exam/add")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("创建考试")])]),_._v(" "),v("tr",[v("td",[_._v("/exam/delete")]),_._v(" "),v("td",[_._v("DELETE")]),_._v(" "),v("td",[_._v("删除考试")])]),_._v(" "),v("tr",[v("td",[_._v("/exam/list")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("考试列表")])]),_._v(" "),v("tr",[v("td",[_._v("/exam/save")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("保存试卷内容")])]),_._v(" "),v("tr",[v("td",[_._v("/exam/publish")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("发布考试")])])])]),_._v(" "),v("p",[_._v("答卷模块：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("接口路径")]),_._v(" "),v("th",[_._v("请求方式")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("/answer/add")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("添加答卷")])]),_._v(" "),v("tr",[v("td",[_._v("/answer/list")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("答卷列表")])]),_._v(" "),v("tr",[v("td",[_._v("/answer/export")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("导出答卷列表为 excel")])])])]),_._v(" "),v("p",[_._v("分析模块：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("接口路径")]),_._v(" "),v("th",[_._v("请求方式")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("/analyse/ranking")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("成绩排行榜")])])])]),_._v(" "),v("h2",{attrs:{id:"总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[_._v("#")]),_._v(" 总结")]),_._v(" "),v("p",[_._v("这节我们设计了下技术方案。")]),_._v(" "),v("p",[_._v("技术栈：前端是 antd + react + vite，后端是 nest + prisma，数据库是 mysql + redis，对象存储用 minio，API 文档用 swagger 生成，部署用 docker compose + pm2，网关使用 nginx，注册中心配置中心用 nacos，消息队列用 rabbitmq。")]),_._v(" "),v("p",[_._v("划分了 4 个微服务：用户微服务、考试微服务、答卷微服务、分析微服务")]),_._v(" "),v("p",[_._v("之间通过 TCP 做同步通信，通过 RabbitMQ 做异步通信。")]),_._v(" "),v("p",[_._v("数据库表有 3 个：用户表 user、考试表 exam、答卷表 answer")]),_._v(" "),v("p",[_._v("模块有 4 个：用户模块、考试模块、答卷模块、分析模块")]),_._v(" "),v("p",[_._v("下节正式开始开发。")])])}),[],!1,null,null,null);v.default=e.exports}}]);