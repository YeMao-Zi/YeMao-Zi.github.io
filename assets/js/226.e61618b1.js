(window.webpackJsonp=window.webpackJsonp||[]).push([[226],{603:function(_,v,t){"use strict";t.r(v);var d=t(5),e=Object(d.a)({},(function(){var _=this,v=_._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[v("p",[_._v("上节我们梳理了有哪些需求，并且画了原型图，明确了要做什么。")]),_._v(" "),v("p",[_._v("这节我们来过一下技术方案，设计下数据库，也就是怎么做。")]),_._v(" "),v("h2",{attrs:{id:"技术栈"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#技术栈"}},[_._v("#")]),_._v(" 技术栈")]),_._v(" "),v("p",[_._v("我们要做的是一个全栈项目，前端用 React + AntD （或者可以换成其他前端框架），后端用 Nest。")]),_._v(" "),v("p",[_._v("技术栈如下：")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2a31317feed0415eb61ae2648f3aa946~tplv-k3u1fbpfcp-watermark.image?",alt:""}})]),_._v(" "),v("p",[_._v("前端使用 create-react-app 脚手架创建项目，使用 react + antd 开发页面。")]),_._v(" "),v("p",[_._v("使用 nginx 来网关层，实现静态资源的托管，并且对于动态资源请求做负载均衡。")]),_._v(" "),v("p",[_._v("使用 Nest 开发后端业务逻辑，使用 TypeORM + mysql 来做 CRUD。")]),_._v(" "),v("p",[_._v("使用 Redis 来做缓存，减轻数据库的压力，提高响应性能。")]),_._v(" "),v("p",[_._v("api 文档使用 Swagger 来生成。")]),_._v(" "),v("p",[_._v("部署使用 Docker Compose 的方式。")]),_._v(" "),v("p",[_._v("PM2 可用可不用，不用 PM2 就要启动容器的时候指定重启策略了，这里为了简单我们还是用 PM2。")]),_._v(" "),v("p",[_._v("都是前面讲过的技术，这里只是综合运用。")]),_._v(" "),v("p",[_._v("然后来设计下数据库：")]),_._v(" "),v("h2",{attrs:{id:"数据库设计"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#数据库设计"}},[_._v("#")]),_._v(" 数据库设计")]),_._v(" "),v("p",[_._v("首先是用户表 users：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("用户ID")])]),_._v(" "),v("tr",[v("td",[_._v("username")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("用户名")])]),_._v(" "),v("tr",[v("td",[_._v("password")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("密码")])]),_._v(" "),v("tr",[v("td",[_._v("nick_name")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("昵称")])]),_._v(" "),v("tr",[v("td",[_._v("email")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("邮箱")])]),_._v(" "),v("tr",[v("td",[_._v("head_pic")]),_._v(" "),v("td",[_._v("VARCHAR(100)")]),_._v(" "),v("td",[_._v("头像")])]),_._v(" "),v("tr",[v("td",[_._v("phone_number")]),_._v(" "),v("td",[_._v("VARCHAR(20)")]),_._v(" "),v("td",[_._v("手机号")])]),_._v(" "),v("tr",[v("td",[_._v("is_frozen")]),_._v(" "),v("td",[_._v("BOOLEAN")]),_._v(" "),v("td",[_._v("是否被冻结")])]),_._v(" "),v("tr",[v("td",[_._v("is_admin")]),_._v(" "),v("td",[_._v("BOOLEAN")]),_._v(" "),v("td",[_._v("是否是管理员")])]),_._v(" "),v("tr",[v("td",[_._v("create_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("创建时间")])]),_._v(" "),v("tr",[v("td",[_._v("update_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("更新时间")])])])]),_._v(" "),v("p",[_._v("用户需要区分普通用户和管理员，所以加了个 is_admin 字段。")]),_._v(" "),v("p",[_._v("然后是会议室表 meeting_rooms：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("会议室ID")])]),_._v(" "),v("tr",[v("td",[_._v("name")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("会议室名字")])]),_._v(" "),v("tr",[v("td",[_._v("capacity")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("会议室容量")])]),_._v(" "),v("tr",[v("td",[_._v("location")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("会议室位置")])]),_._v(" "),v("tr",[v("td",[_._v("equipment")]),_._v(" "),v("td",[_._v("VARCHAR(50)")]),_._v(" "),v("td",[_._v("设备")])]),_._v(" "),v("tr",[v("td",[_._v("description")]),_._v(" "),v("td",[_._v("VARCHAR(100)")]),_._v(" "),v("td",[_._v("描述")])]),_._v(" "),v("tr",[v("td",[_._v("is_booked")]),_._v(" "),v("td",[_._v("BOOLEAN")]),_._v(" "),v("td",[_._v("是否被预订")])]),_._v(" "),v("tr",[v("td",[_._v("create_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("创建时间")])]),_._v(" "),v("tr",[v("td",[_._v("update_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("更新时间")])])])]),_._v(" "),v("p",[_._v("接下来是预订表 bookings：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("预订ID")])]),_._v(" "),v("tr",[v("td",[_._v("user_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("预订用户ID")])]),_._v(" "),v("tr",[v("td",[_._v("room_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("会议室ID")])]),_._v(" "),v("tr",[v("td",[_._v("start_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("会议开始时间")])]),_._v(" "),v("tr",[v("td",[_._v("end_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("会议结束时间")])]),_._v(" "),v("tr",[v("td",[_._v("status")]),_._v(" "),v("td",[_._v("VARCHAR(20)")]),_._v(" "),v("td",[_._v("状态（申请中、审批通过、审批驳回、已解除）")])]),_._v(" "),v("tr",[v("td",[_._v("note")]),_._v(" "),v("td",[_._v("VARCHAR(100)")]),_._v(" "),v("td",[_._v("备注")])]),_._v(" "),v("tr",[v("td",[_._v("create_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("创建时间")])]),_._v(" "),v("tr",[v("td",[_._v("update_time")]),_._v(" "),v("td",[_._v("DATETIME")]),_._v(" "),v("td",[_._v("更新时间")])])])]),_._v(" "),v("p",[_._v("然后是预订-参会人表 booking_attendees：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("ID")])]),_._v(" "),v("tr",[v("td",[_._v("user_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("参会用户ID")])]),_._v(" "),v("tr",[v("td",[_._v("booking_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("预订ID")])])])]),_._v(" "),v("p",[_._v("这几个表的关系如下：")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fb13cbbd6dda4c8e95e46aeea52b21c5~tplv-k3u1fbpfcp-watermark.image?",alt:""}})]),_._v(" "),v("p",[_._v("再加上角色表、权限表，还有 2 个中间表：")]),_._v(" "),v("p",[_._v("角色表 roles")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("ID")])]),_._v(" "),v("tr",[v("td",[_._v("name")]),_._v(" "),v("td",[_._v("VARCHAR(20)")]),_._v(" "),v("td",[_._v("角色名")])])])]),_._v(" "),v("p",[_._v("权限表 permissions")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("ID")])]),_._v(" "),v("tr",[v("td",[_._v("code")]),_._v(" "),v("td",[_._v("VARCHAR(20)")]),_._v(" "),v("td",[_._v("权限代码")])]),_._v(" "),v("tr",[v("td",[_._v("description")]),_._v(" "),v("td",[_._v("VARCHAR(100)")]),_._v(" "),v("td",[_._v("权限描述")])])])]),_._v(" "),v("p",[_._v("用户-角色中间表 user_roles")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("ID")])]),_._v(" "),v("tr",[v("td",[_._v("user_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("用户 ID")])]),_._v(" "),v("tr",[v("td",[_._v("role_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("角色 ID")])])])]),_._v(" "),v("p",[_._v("角色-权限中间表 role_permissions")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("字段名")]),_._v(" "),v("th",[_._v("数据类型")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("ID")])]),_._v(" "),v("tr",[v("td",[_._v("role_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("角色 ID")])]),_._v(" "),v("tr",[v("td",[_._v("permission_id")]),_._v(" "),v("td",[_._v("INT")]),_._v(" "),v("td",[_._v("权限 ID")])])])]),_._v(" "),v("p",[v("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/698725b25d9843af8e5f41691830054e~tplv-k3u1fbpfcp-watermark.image?",alt:""}})]),_._v(" "),v("p",[_._v("设计完数据库，我们再来划分下模块：")]),_._v(" "),v("h2",{attrs:{id:"模块划分"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#模块划分"}},[_._v("#")]),_._v(" 模块划分")]),_._v(" "),v("p",[_._v("首先是用户模块，实现普通用户和管理员的登录、注册、信息修改的功能：")]),_._v(" "),v("p",[_._v("大概有这些接口：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("接口路径")]),_._v(" "),v("th",[_._v("请求方式")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("/user/login")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("普通用户登录")])]),_._v(" "),v("tr",[v("td",[_._v("/user/register")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("普通用户注册")])]),_._v(" "),v("tr",[v("td",[_._v("/user/update")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("普通用户个人信息修改")])]),_._v(" "),v("tr",[v("td",[_._v("/user/update_password")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("普通用户修改密码")])]),_._v(" "),v("tr",[v("td",[_._v("/user/admin/login")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("管理员登录")])]),_._v(" "),v("tr",[v("td",[_._v("/user/admin/update_password")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("管理员修改密码")])]),_._v(" "),v("tr",[v("td",[_._v("/user/admin/update")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("管理员个人信息修改")])]),_._v(" "),v("tr",[v("td",[_._v("/user/list")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("用户列表")])]),_._v(" "),v("tr",[v("td",[_._v("/user/freeze")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("冻结用户")])])])]),_._v(" "),v("p",[_._v("然后是会议室管理模块：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("接口路径")]),_._v(" "),v("th",[_._v("请求方式")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("/meeting_room/list")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("会议室列表")])]),_._v(" "),v("tr",[v("td",[_._v("/meeting_room/delete/:id")]),_._v(" "),v("td",[_._v("DELETE")]),_._v(" "),v("td",[_._v("会议室删除")])]),_._v(" "),v("tr",[v("td",[_._v("/meeting_room/update/:id")]),_._v(" "),v("td",[_._v("PUT")]),_._v(" "),v("td",[_._v("会议室更新")])]),_._v(" "),v("tr",[v("td",[_._v("/meeting_room/create")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("会议室新增")])]),_._v(" "),v("tr",[v("td",[_._v("/meeting_room/search")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("会议室搜索")])])])]),_._v(" "),v("p",[_._v("然后是预订管理模块：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("接口路径")]),_._v(" "),v("th",[_._v("请求方式")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("/booking/list")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("预订列表")])]),_._v(" "),v("tr",[v("td",[_._v("/booking/approve")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("审批预订申请")])]),_._v(" "),v("tr",[v("td",[_._v("/booking/add")]),_._v(" "),v("td",[_._v("POST")]),_._v(" "),v("td",[_._v("申请预订")])]),_._v(" "),v("tr",[v("td",[_._v("/booking/apply/:id")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("通过预订")])]),_._v(" "),v("tr",[v("td",[_._v("/booking/reject/:id")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("取消预订")])]),_._v(" "),v("tr",[v("td",[_._v("/booking/unbind/:id")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("解除预订")])]),_._v(" "),v("tr",[v("td",[_._v("/booking/history")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("预订历史")])]),_._v(" "),v("tr",[v("td",[_._v("/booking/urge")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("催办")])])])]),_._v(" "),v("p",[_._v("然后是统计模块：")]),_._v(" "),v("table",[v("thead",[v("tr",[v("th",[_._v("接口路径")]),_._v(" "),v("th",[_._v("请求方式")]),_._v(" "),v("th",[_._v("描述")])])]),_._v(" "),v("tbody",[v("tr",[v("td",[_._v("/statistics/meeting_room_usage_frequency")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("会议室使用频率统计")])]),_._v(" "),v("tr",[v("td",[_._v("/statistics/user_booking_frequency")]),_._v(" "),v("td",[_._v("GET")]),_._v(" "),v("td",[_._v("用户预订频率统计")])])])]),_._v(" "),v("p",[v("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc0d69f1729d4a2eb689446c2e7179c3~tplv-k3u1fbpfcp-watermark.image?",alt:""}})]),_._v(" "),v("h2",{attrs:{id:"角色划分"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#角色划分"}},[_._v("#")]),_._v(" 角色划分")]),_._v(" "),v("p",[_._v("权限控制使用 RBAC 的方式，有普通用户和管理员两个角色，")]),_._v(" "),v("p",[_._v("两个角色各自可以操作的接口就是上节用例图画的那些：")]),_._v(" "),v("p",[v("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f2c9a82600a748f0aa322086e26ad363~tplv-k3u1fbpfcp-watermark.image?",alt:""}})]),_._v(" "),v("p",[v("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bbf790f3bbf44c5fa8cc2bc9b46fd14c~tplv-k3u1fbpfcp-watermark.image?",alt:""}})]),_._v(" "),v("p",[v("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6b7490fc6316448b94ab6fcbd54c4a7f~tplv-k3u1fbpfcp-watermark.image?",alt:""}})]),_._v(" "),v("h2",{attrs:{id:"总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[_._v("#")]),_._v(" 总结")]),_._v(" "),v("p",[_._v("这节我们设计了下技术方案。")]),_._v(" "),v("p",[_._v("技术栈：前端是 antd + react + cra，后端是 nest + typeorm，数据库是 mysql + redis，API 文档用 swagger 生成，部署用 docker compose + pm2，网关使用 nginx。")]),_._v(" "),v("p",[_._v("数据库表有 8 个：用户表 users、会议室表 meeting_rooms、预订表 bookings、预订-参会者表 booking_attendees、角色表 roles、权限表 permissions、用户-角色表 user_roles、角色-权限表 role_permissions。")]),_._v(" "),v("p",[_._v("模块有 4 个：用户管理模块、会议室管理模块、预订管理模块、统计管理模块。")]),_._v(" "),v("p",[_._v("角色有两个：普通用户、管理员，各自拥有的权限按照用例图来。使用 RBAC 来控制接口访问权限。")]),_._v(" "),v("p",[_._v("技术方案确定之后，下节开始我们就正式进入开发了。")])])}),[],!1,null,null,null);v.default=e.exports}}]);