(window.webpackJsonp=window.webpackJsonp||[]).push([[378],{752:function(t,s,a){"use strict";a.r(s);var n=a(5),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("Nginx 是流行的服务器，一般用它对静态资源做托管、对动态资源做反向代理。")]),t._v(" "),s("p",[t._v("Docker 是流行的容器技术，里面可以跑任何服务。")]),t._v(" "),s("h2",{attrs:{id:"那-docker-nginx-如何结合使用呢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#那-docker-nginx-如何结合使用呢"}},[t._v("#")]),t._v(" 那 Docker + Nginx 如何结合使用呢？")]),t._v(" "),s("p",[t._v("我们来试一下：")]),t._v(" "),s("p",[t._v("搜索 nginx（这一步需要科学上网，因为要访问 hub.docker.com 这个网站），点击 run：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/eRhT8OBNqd1JslL.png",alt:""}})]),t._v(" "),s("p",[t._v("输入容器名和要映射的端口：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/KwVJPu9jDcYEpCn.png",alt:""}})]),t._v(" "),s("p",[t._v("这里把宿主机的 81 端口映射到容器内的 80 端口，点击 run。")]),t._v(" "),s("p",[t._v("这时候就可以看到 docker 容器跑起来了，并且打印了日志：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/HvX3kYjsteBLlN6.png",alt:""}})]),t._v(" "),s("p",[t._v("浏览器访问下 http://localhost:81 可以看到 nginx 欢迎页面：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/zFVUPlI3mj5DkOa.png",alt:""}})]),t._v(" "),s("p",[t._v("这很明显是容器里跑的服务。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/eVND71amvydC2Ux.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"但是现在的页面是默认的-我想用-nginx-来托管我的一些静态-html-页面怎么做呢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#但是现在的页面是默认的-我想用-nginx-来托管我的一些静态-html-页面怎么做呢"}},[t._v("#")]),t._v(" 但是现在的页面是默认的，我想用 nginx 来托管我的一些静态 html 页面怎么做呢？")]),t._v(" "),s("p",[t._v("首先我们要知道现在的配置文件和页面都存在哪里。")]),t._v(" "),s("p",[t._v("在 files 面板可以看到容器内的文件：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/HM8tkCKqvWYxAfi.png",alt:""}})]),t._v(" "),s("p",[t._v("里面的 /usr/share/nginx/html/ 目录下面就是所有的静态文件。")]),t._v(" "),s("p",[t._v("双击点开 index.html 看看：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/uNy6xarWqinIHw8.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/FMDR3Wu8ZOHSkLC.png",alt:""}})]),t._v(" "),s("p",[t._v("和我们浏览器看到的页面一毛一样。")]),t._v(" "),s("p",[t._v("也就是说，这个目录就是保存静态文件的目录。")]),t._v(" "),s("p",[t._v("那我们在这个目录下放我们自己的 html 不就行了？")]),t._v(" "),s("p",[t._v("我们先把这个目录复制出来：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker cp  nginx1:/usr/share/nginx/html ~/nginx-html\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/rWVJ56KMwufRFSH.png",alt:""}})]),t._v(" "),s("p",[t._v("docker cp 这个命令就是用于在宿主机和容器之间复制文件和目录的。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/s2M8q3ELtReP9xk.png",alt:""}})]),t._v(" "),s("p",[t._v("比如我们把这个目录再复制到容器里：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker cp  ~/nginx-html nginx1:/usr/share/nginx/html-xxx\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("可以看到容器内就多了这个目录：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/WpsSEN5TPxL6Ioa.png",alt:""}})]),t._v(" "),s("p",[t._v("然后我们在这个目录下添加两个 html 来试试看：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("echo aaa > aaa.html\n\necho bbb > bbb.html\n\ndocker cp  ~/nginx-html nginx1:/usr/share/nginx/html\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/UzQmr73LVpwd2OF.png",alt:""}})]),t._v(" "),s("p",[t._v("但当目标目录存在的时候，docker 会把他复制到目标目录下面：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/FhoRQrNatBbLUEH.png",alt:""}})]),t._v(" "),s("p",[t._v("我们需要先删除容器的这个目录，再复制：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/4xcldFLzgPhVRkC.png",alt:""}})]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker cp  ~/nginx-html nginx1:/usr/share/nginx/html\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("这样就好了：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/PI6YS3auvyOJZ1G.png",alt:""}})]),t._v(" "),s("p",[t._v("然后浏览器访问下试试：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/9dLamc8UEKs1xro.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/jZkiTlIShnW6fbX.png",alt:""}})]),t._v(" "),s("p",[t._v("现在就可以访问容器内的这些目录了。")]),t._v(" "),s("h3",{attrs:{id:"也就是说只要放到-usr-share-nginx-html-下的文件-都可以通过被访问到。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#也就是说只要放到-usr-share-nginx-html-下的文件-都可以通过被访问到。"}},[t._v("#")]),t._v(" 也就是说只要放到 /usr/share/nginx/html 下的文件，都可以通过被访问到。")]),t._v(" "),s("p",[t._v("可是为什么呢？")]),t._v(" "),s("p",[t._v("这是因为 nginx 的默认配置。")]),t._v(" "),s("p",[t._v("我们看下 nginx 配置文件，也就是 /etc/nginx/nginx.conf。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/pM9kEo6I4gOKaXL.png",alt:""}})]),t._v(" "),s("p",[t._v("复制出来看看：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker cp  nginx1:/etc/nginx/nginx.conf ~/nginx-html\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("这是就是 nginx 的默认配置：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/yfmUvkWjA9qnKe8.png",alt:""}})]),t._v(" "),s("p",[t._v("其实这个 nginx.conf 叫做主配置文件，里面一般做一些全局的配置，比如错误日志的目录等等。")]),t._v(" "),s("p",[t._v("可以看到 http 下面有个 include 引入了 /etc/nginx/conf.d/*.conf 的配置。")]),t._v(" "),s("p",[t._v("一般具体的路由配置都是在这些子配置文件里。")]),t._v(" "),s("p",[t._v("目录 conf.d 是 configuration directory 的意思。")]),t._v(" "),s("p",[t._v("我们把这个目录也复制出来看看：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker cp  nginx1:/etc/nginx/conf.d ~/nginx-html\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("这里面就配置了 localhost:80 的虚拟主机下的所有路由。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/EkP1umdb7DcWCiq.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"虚拟主机是什么呢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#虚拟主机是什么呢"}},[t._v("#")]),t._v(" 虚拟主机是什么呢？")]),t._v(" "),s("p",[t._v("就是可以用一台 nginx 服务器来为多个域名和端口的提供服务。")]),t._v(" "),s("p",[t._v("只要多加几个 server 配置就可以。")]),t._v(" "),s("p",[t._v("这里我们就配置 localhost:80 这一个虚拟主机。")]),t._v(" "),s("p",[t._v("下面的 location 就是路由配置。")]),t._v(" "),s("p",[t._v("比如这个配置：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/YpjfFcBdsXA5OeV.png",alt:""}})]),t._v(" "),s("p",[t._v("它就配置了 / 下的所有路由，都是在 root 指定的目录查找。")]),t._v(" "),s("p",[t._v("所以 http://localhost/aaa.html 就是从 /usr/share/nginx/html/aaa.html 找的。")]),t._v(" "),s("h3",{attrs:{id:"location-支持的语法有好几个-我们分别试一下"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#location-支持的语法有好几个-我们分别试一下"}},[t._v("#")]),t._v(" location 支持的语法有好几个，我们分别试一下：")]),t._v(" "),s("div",{staticClass:"language-nginx line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" = /111/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default_type")]),t._v(" text/plain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"111 success"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /222")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default_type")]),t._v(" text/plain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~ ^/333/bbb.*\\.html$")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default_type")]),t._v(" text/plain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~* ^/444/AAA.*\\.html$")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default_type")]),t._v(" text/plain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$uri")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br")])]),s("p",[t._v("把之前的 location / 删掉，添加这样几个路由配置。")]),t._v(" "),s("p",[t._v("具体这些配置都是什么意思待会再说。")]),t._v(" "),s("p",[t._v("把这个文件复制到容器内：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker cp ~/nginx-html/conf.d/default.conf nginx1:/etc/nginx/conf.d/default.conf\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("然后在容器内的 terminal 执行：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("nginx -s reload\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("重新加载配置文件。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/fd9rUBsFc6Zqj2y.png",alt:""}})]),t._v(" "),s("p",[t._v("然后来看第一条路由：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/MTtYERo7IZPazS9.png",alt:""}})]),t._v(" "),s("p",[t._v("location 和路径之间加了个 =，代表精准匹配，也就是只有完全相同的 url 才会匹配这个路由。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/VQmsiYSMrGcd4uI.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/Fc9GXPUWa6Mr85u.png",alt:""}})]),t._v(" "),s("p",[t._v("不带 = 代表根据前缀匹配，后面可以是任意路径。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/9dpocRKbZVjxhwC.png",alt:""}})]),t._v(" "),s("p",[t._v("这里的 $uri 是取当前路径。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/t5njSNywagi1FmX.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/anLfVxedEGWFXyk.png",alt:""}})]),t._v(" "),s("p",[t._v("然后如果想支持正则，就可以加个 ~。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/cEaTFP12Zfw6oOq.png",alt:""}})]),t._v(" "),s("p",[t._v("这里的正则语法不难看懂，就是 /333/bbb 开头，然后中间是任意字符，最后 .html 结尾的 url。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/NAyQP8HC1MF3D6l.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/b9vyzPwEBH3dFoY.png",alt:""}})]),t._v(" "),s("p",[t._v("但是它是区分大小写的，比如这样就不行了：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/7BaURlu5gAeHomt.png",alt:""}})]),t._v(" "),s("p",[t._v("换成小写就可以：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/m5CGXcUx1qyOzjw.png",alt:""}})]),t._v(" "),s("p",[t._v("如果想让正则不区分大小写，可以再加个 *")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/JEpYBKg1zfr98GX.png",alt:""}})]),t._v(" "),s("p",[t._v("试一下：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/jFADvPxaIkWd8Sc.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/OKQVMrzeHUWg7aP.png",alt:""}})]),t._v(" "),s("p",[t._v("任意的大小写都是可以的。")]),t._v(" "),s("p",[t._v("此外，还有一种语法：")]),t._v(" "),s("p",[t._v("在配置文件加上这个配置：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("location /444 {\n    default_type text/plain;\n    return 200 'xxxx';\n}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("然后复制到容器里，并 reload：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker cp ~/nginx-html/conf.d/default.conf nginx1:/etc/nginx/conf.d/default.conf\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/AP3g5lxakdBeY2j.png",alt:""}})]),t._v(" "),s("p",[t._v("这时候就有两个 /444 的路由了：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/9TV7iUHzkNJxF4u.png",alt:""}})]),t._v(" "),s("p",[t._v("这时候浏览器访问，还是匹配上面的那个路由：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/fn8WigAuP1IY93p.png",alt:""}})]),t._v(" "),s("p",[t._v("如果想提高优先级，可以使用 ^~")]),t._v(" "),s("p",[t._v("改成这样：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("location ^~ /444 {\n    default_type text/plain;\n    return 200 'xxxx';\n}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("然后复制到容器里，并 reload：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker cp ~/nginx-html/conf.d/default.conf nginx1:/etc/nginx/conf.d/default.conf\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/G7fs5QXda8WgAnR.png",alt:""}})]),t._v(" "),s("p",[t._v("这时候同一个 url，匹配的就是下面的路由了：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/TF1XVYrJb7uDstp.png",alt:""}})]),t._v(" "),s("p",[t._v("也就是说 ^~ 能够提高前缀匹配的优先级。")]),t._v(" "),s("h3",{attrs:{id:"总结一下-一共-4-个-location-语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结一下-一共-4-个-location-语法"}},[t._v("#")]),t._v(" 总结一下，一共 4 个 location 语法：")]),t._v(" "),s("p",[t._v("location = /aaa 是精确匹配 /aaa 的路由。")]),t._v(" "),s("p",[t._v("location /bbb 是前缀匹配 /bbb 的路由。")]),t._v(" "),s("p",[t._v("location ~ /ccc.*.html 是正则匹配。可以再加个 * 表示不区分大小写 location ~* /ccc.*.html")]),t._v(" "),s("p",[t._v("location ^~ /ddd 是前缀匹配，但是优先级更高。")]),t._v(" "),s("p",[t._v("这 4 种语法的优先级是这样的：")]),t._v(" "),s("p",[s("strong",[t._v("精确匹配（=） > 高优先级前缀匹配（^~） > 正则匹配（～ ~*） > 普通前缀匹配")])]),t._v(" "),s("p",[t._v("我们现在是直接用 return 返回的内容，其实应该返回 html 文件。")]),t._v(" "),s("p",[t._v("可以这样改：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("location /222 {\n    alias /usr/share/nginx/html;\n}\n\nlocation ~ ^/333/bbb.*\\.html$ {\n    alias /usr/share/nginx/html/bbb.html;\n}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("然后复制到容器里，并 reload：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker cp ~/nginx-html/conf.d/default.conf nginx1:/etc/nginx/conf.d/default.conf\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/G7fs5QXda8WgAnR.png",alt:""}})]),t._v(" "),s("p",[t._v("都是能正确返回对应的 html 的：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/LlYXSJCMgvO2w93.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/2w9NTWQV8pkPFIt.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/RHEcpKA6Zxtdnzo.png",alt:""}})]),t._v(" "),s("p",[t._v("前面用过 root：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/318dc32f873146b5a758533ce62a611f~tplv-k3u1fbpfcp-watermark.image?",alt:""}})]),t._v(" "),s("p",[t._v("root 和 alias 有什么区别呢？")]),t._v(" "),s("p",[t._v("比如这样的两个配置：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("location /222 {\n    alias /dddd;\n}\n\nlocation /222 {\n    root /dddd;\n}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("同样是 /222/xxx/yyy.html，如果是用 root 的配置，会把整个 uri 作为路径拼接在后面。")]),t._v(" "),s("p",[t._v("也就是会查找 /dddd/222/xxx/yyy.html 文件。")]),t._v(" "),s("p",[t._v("如果是 alias 配置，它会把去掉 /222 之后的部分路径拼接在后面。")]),t._v(" "),s("p",[t._v("也就是会查找 /dddd/xxx/yyy.html 文件。")]),t._v(" "),s("p",[t._v("也就是 我们 "),s("strong",[t._v("root 和 alias 的区别就是拼接路径时是否包含匹配条件的路径。")])]),t._v(" "),s("p",[t._v("这就是 nginx 的第一个功能：静态文件托管。")]),t._v(" "),s("p",[t._v("主配置文件在 /etc/nginx/nginx.conf，而子配置文件在 /etc/nginx/conf.d 目录下。")]),t._v(" "),s("p",[t._v("默认的 html 路径是 /usr/share/nginx/html。")]),t._v(" "),s("h2",{attrs:{id:"然后来看下-nginx-的第二大功能-动态资源的反向代理。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#然后来看下-nginx-的第二大功能-动态资源的反向代理。"}},[t._v("#")]),t._v(" 然后来看下 nginx 的第二大功能：动态资源的反向代理。")]),t._v(" "),s("p",[t._v("什么是正向、什么是反向呢？")]),t._v(" "),s("p",[t._v("从用户的角度看，方向一致的就是正向，反过来就是反向。")]),t._v(" "),s("p",[t._v("比如这样两个代理：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/7PMO2vGHV6Z4zp9.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/BGsN98eTb1P632q.png",alt:""}})]),t._v(" "),s("p",[t._v("第一个是正向代理，第二个是反向代理。")]),t._v(" "),s("p",[t._v("第一个代理是代理的用户请求，和用户请求方向一致，叫做正向代理。")]),t._v(" "),s("p",[t._v("第二个代理是代理服务器处理用户请求，和用户请求方向相反，叫做反向代理。")]),t._v(" "),s("p",[t._v("测试 nginx 做反向代理服务器之前，我们先创建个 nest 服务。")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("npx nest new nest-app -p npm\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/8UFJ6r9ebwQxvuZ.png",alt:""}})]),t._v(" "),s("p",[t._v("把服务跑起来：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("npm run start:dev\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/qa5tpGZPkDB9XVT.png",alt:""}})]),t._v(" "),s("p",[t._v("浏览器就访问 http://localhost:3000 看到 hello world 就代表 nest 服务跑成功了：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/LNcTxWzdpjIYZtS.png",alt:""}})]),t._v(" "),s("p",[t._v("添加一个全局的前缀 /api")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/xnCyd65VhguTSRU.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/nrpj8Zx9MyIeSPc.png",alt:""}})]),t._v(" "),s("p",[t._v("改下 nginx 配置，添加个路由：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("location ^~ /api {\n    proxy_pass http://192.168.1.6:3000;\n}\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("这个路由是根据前缀匹配 /api 开头的 url， ^~ 是提高优先级用的。")]),t._v(" "),s("p",[t._v("然后复制到容器里，并 reload：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker cp ~/nginx-html/conf.d/default.conf nginx1:/etc/nginx/conf.d/default.conf\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/G7fs5QXda8WgAnR.png",alt:""}})]),t._v(" "),s("p",[t._v("然后你访问 http://localhost:81/api 就可以看到 nest 服务返回的响应了：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/gKVtQumRAESzliC.png",alt:""}})]),t._v(" "),s("p",[t._v("也就是这样的：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/DWpMAlrOPG37nmE.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"为什么要多-nginx-这一层代理呢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么要多-nginx-这一层代理呢"}},[t._v("#")]),t._v(" 为什么要多 nginx 这一层代理呢？")]),t._v(" "),s("p",[t._v("自然是可以在这一层做很多事情的。")]),t._v(" "),s("p",[t._v("比如修改 header：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/nWoLeEd5A3DbwZs.png",alt:""}})]),t._v(" "),s("p",[t._v("然后复制到容器里，并 reload：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker cp ~/nginx-html/conf.d/default.conf nginx1:/etc/nginx/conf.d/default.conf\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/G7fs5QXda8WgAnR.png",alt:""}})]),t._v(" "),s("p",[t._v("在 nest 服务的 handler 里注入 headers，打印一下：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/amGMR3i9elBIkKT.png",alt:""}})]),t._v(" "),s("p",[t._v("然后浏览器访问下。")]),t._v(" "),s("p",[t._v("直接访问 nest 服务的话，是没有这个 header 的：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/gexjVm8M7BEhcoG.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/I9iDd7wEslhRyuG.png",alt:""}})]),t._v(" "),s("p",[t._v("访问 nginx 的反向代理服务器，做一次中转：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/u2jRnf3gvIixhmQ.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/rxFeQgjCcW2mdZP.png",alt:""}})]),t._v(" "),s("p",[t._v("这就是反向代理服务器的作用，可以透明的修改请求、响应。")]),t._v(" "),s("h3",{attrs:{id:"而且-还可以用它实现负载均衡。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#而且-还可以用它实现负载均衡。"}},[t._v("#")]),t._v(" 而且，还可以用它实现负载均衡。")]),t._v(" "),s("p",[t._v("在 controlller 里打印下访问日志：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/VNCGSHrxLpvD2PX.png",alt:""}})]),t._v(" "),s("p",[t._v("把 nest 服务停掉，然后重新 npm run start")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/wF37pEnSMPxL4HZ.png",alt:""}})]),t._v(" "),s("p",[t._v("3001 和 3002 端口各跑一个：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/TdblWQBqxcXCZGm.png",alt:""}})]),t._v(" "),s("p",[t._v("浏览器访问下，都是正常的：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/ryUDx9Rk8fuIsHS.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/dIylNxugnSwiFK3.png",alt:""}})]),t._v(" "),s("p",[t._v("控制台也打印了访问日志：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/ErSWv1q4BwHNlaf.png",alt:""}})]),t._v(" "),s("p",[t._v("问题来了，现在有一个 nginx 服务器，两个 nest 服务器了，nginx 该如何应对呢？")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/3z5IcyfaYuoxZij.png",alt:""}})]),t._v(" "),s("p",[t._v("nginx 的解决方式就是负载均衡，把请求按照一定的规则分到不同的服务器。")]),t._v(" "),s("p",[t._v("改下 nginx 配置文件：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/68eAgKabLfSwJFo.png",alt:""}})]),t._v(" "),s("p",[t._v("在 upstream 里配置它代理的目标服务器的所有实例。")]),t._v(" "),s("p",[t._v("下面 proxy_pass 通过 upstream 的名字来指定。")]),t._v(" "),s("p",[t._v("然后复制到容器里，并 reload：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker cp ~/nginx-html/conf.d/default.conf nginx1:/etc/nginx/conf.d/default.conf\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/G7fs5QXda8WgAnR.png",alt:""}})]),t._v(" "),s("p",[t._v("这时候我访问 http://localhost:81/api 刷新 5 次页面：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/67d1a60b7fdf4f8b81fb9ccd6fed01ce~tplv-k3u1fbpfcp-watermark.image?",alt:""}})]),t._v(" "),s("p",[t._v("可以看到两个 nest 服务，一个 3 次，一个 2 次。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/DPbVdqjaTsUh7NB.png",alt:""}})]),t._v(" "),s("p",[t._v("因为默认是轮询的方式。")]),t._v(" "),s("h3",{attrs:{id:"一共有-4-种负载均衡策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一共有-4-种负载均衡策略"}},[t._v("#")]),t._v(" 一共有 4 种负载均衡策略：")]),t._v(" "),s("ul",[s("li",[t._v("轮询：默认方式。")]),t._v(" "),s("li",[t._v("weight：在轮询基础上增加权重，也就是轮询到的几率不同。")]),t._v(" "),s("li",[t._v("ip_hash：按照 ip 的 hash 分配，保证每个访客的请求固定访问一个服务器，解决 session 问题。")]),t._v(" "),s("li",[t._v("fair：按照响应时间来分配，这个需要安装 nginx-upstream-fair 插件。")])]),t._v(" "),s("p",[t._v("我们测试下 weight 和 ip_hash 的方式。")]),t._v(" "),s("p",[t._v("添加一个 weight=2，默认是 1，这样两个服务器轮询到的几率是 2 比 1。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/5wTSUk9VviNfelo.png",alt:""}})]),t._v(" "),s("p",[t._v("然后复制到容器里，并 reload：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker cp ~/nginx-html/conf.d/default.conf nginx1:/etc/nginx/conf.d/default.conf\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/G7fs5QXda8WgAnR.png",alt:""}})]),t._v(" "),s("p",[t._v("按 command + k，把 nest 服务的控制台日志清空下：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/YrozNSpu1tsC4WX.png",alt:""}})]),t._v(" "),s("p",[t._v("然后我访问了 8 次 http://localhost:81/api")]),t._v(" "),s("p",[t._v("看打印的日志来看，差不多就是 2:1 的轮询几率。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/C5zshcwbEo9xKG3.png",alt:""}})]),t._v(" "),s("p",[t._v("这就是带权重的轮询。")]),t._v(" "),s("p",[t._v("我们再试下 ip_hash 的方式；")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/NsvfG35PmbkA7up.png",alt:""}})]),t._v(" "),s("p",[t._v("然后复制到容器里，并 reload：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("docker cp ~/nginx-html/conf.d/default.conf nginx1:/etc/nginx/conf.d/default.conf\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/G7fs5QXda8WgAnR.png",alt:""}})]),t._v(" "),s("p",[t._v("按 command + k，把 nest 服务的控制台日志清空下：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/YrozNSpu1tsC4WX.png",alt:""}})]),t._v(" "),s("p",[t._v("再次访问了 http://localhost:81/api")]),t._v(" "),s("p",[t._v("可以看到一直请求到了一台服务器：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2025/10/16/xAZCdeREm7198Th.png",alt:""}})]),t._v(" "),s("p",[t._v("这就是 Nginx 的负载均衡的策略。")]),t._v(" "),s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),s("p",[t._v("我们通过 docker 跑了 nginx 服务器，并使用了它的静态资源托管功能，还有动态资源的反向代理功能。")]),t._v(" "),s("p",[t._v("nginx 的配置文件在 /etc/nginx/nginx.conf 里，它默认还引入了 /etc/nginx/conf.d 下的子配置文件。")]),t._v(" "),s("p",[t._v("默认 html 都放在 /usr/share/nginx/html 下。")]),t._v(" "),s("p",[t._v("我们可以通过 docker cp 来把容器内文件复制到宿主机来修改。")]),t._v(" "),s("p",[t._v("修改 nginx 配置，在 server 里配置路由，根据不同的 url 返回不同的静态文件。")]),t._v(" "),s("p",[t._v("有 4 种 location 语法：")]),t._v(" "),s("ul",[s("li",[t._v("location /aaa 根据前缀匹配")]),t._v(" "),s("li",[t._v("location ^~ /aaa 根据前缀匹配，优先级更高")]),t._v(" "),s("li",[t._v("location = /aaa 精准匹配")]),t._v(" "),s("li",[t._v("location ~ /aaa/.*html 正则匹配")]),t._v(" "),s("li",[t._v("location ~* /aaa/.*html 正则匹配，而且不区分大小写")])]),t._v(" "),s("p",[t._v("优先级是 精确匹配（=） > 高优先级前缀匹配（^~） > 正则匹配（～ ~*） > 普通前缀匹配")]),t._v(" "),s("p",[t._v("除了静态资源托管外，nginx 还可以对动态资源做反向代理。")]),t._v(" "),s("p",[t._v("也就是请求发给 nginx，由它转发给应用服务器，这一层也可以叫做网关。")]),t._v(" "),s("p",[t._v("nginx 反向代理可以修改请求、响应信息，比如设置 header。")]),t._v(" "),s("p",[t._v("当有多台应用服务器的时候，可以通过 upstream 配置负载均衡，有 4 种策略：轮询、带权重的轮询、ip_hash、fair。")]),t._v(" "),s("p",[t._v("掌握了静态资源托管、动态资源的反向代理+负载均衡，就算是掌握了 Nginx 的核心用法了。")])])}),[],!1,null,null,null);s.default=e.exports}}]);