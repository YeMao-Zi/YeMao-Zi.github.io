(window.webpackJsonp=window.webpackJsonp||[]).push([[564],{937:function(t,s,a){"use strict";a.r(s);var n=a(5),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"渲染机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#渲染机制"}},[t._v("#")]),t._v(" 渲染机制")]),t._v(" "),s("p",[s("code",[t._v("Vue")]),t._v("的整个渲染过程，一共经历了"),s("code",[t._v("5")]),t._v("个步骤：")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("模板解析")]),t._v("，通过"),s("code",[t._v("htmlparser2")]),t._v("的库来解析模板生成包含指令节点、属性节点和文本节点的"),s("code",[t._v("AST")]),t._v("树（抽象语法树）。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("生成渲染函数")]),t._v("，先进行 "),s("code",[t._v("AST")]),t._v(" 静态分析，再转换为渲染函数（"),s("code",[t._v("render")]),t._v(" 函数）。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("挂载（mount）")]),t._v("，挂载时会执行渲染函数，并生成 "),s("code",[t._v("VNode")]),t._v("（虚拟节点），并基于此创建实际的 DOM 节点。")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("更新")]),t._v("，执行 diff 算法，然后将必要的更新应用到真实 DOM 上去。。")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2024/06/28/qzYlmQjGwOobvLA.png",alt:"img"}})]),t._v(" "),s("h2",{attrs:{id:"_1-模板解析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-模板解析"}},[t._v("#")]),t._v(" 1.模板解析")]),t._v(" "),s("p",[t._v("当"),s("code",[t._v("Vue")]),t._v("应用启动时，会将模板传入"),s("code",[t._v("Vue的编译器")]),t._v("进行"),s("code",[t._v("解析和编译")]),t._v("。"),s("code",[t._v("Vue的编译器")]),t._v("将模板解析成一个抽象语法树（AST），并将"),s("code",[t._v("AST")]),t._v("转换为"),s("code",[t._v("渲染函数")]),t._v("。")]),t._v(" "),s("blockquote",[s("p",[t._v("AST 是一种树状的数据结构，表示了模板中各个语法结构之间的关系。语法分析的目的是理解模板的结构，为后续的优化和代码生成提供基础。")])]),t._v(" "),s("p",[t._v("下面是"),s("code",[t._v("Vue")]),t._v("模板解析的基本流程：")]),t._v(" "),s("p",[s("strong",[t._v("1.解析")])]),t._v(" "),s("p",[t._v("编译器首先会对Vue模板进行解析，将模板字符串解析为抽象语法树（AST）。AST是一种以对象的形式表示模板结构的数据结构。")]),t._v(" "),s("p",[s("strong",[t._v("2.静态分析")])]),t._v(" "),s("p",[t._v("在此阶段，编译器会对AST进行静态分析，收集模板中的所有静态节点（不依赖组件实例数据的节点）。这样的静态节点可以在每次重新渲染时重复使用，从而提高性能。")]),t._v(" "),s("h3",{attrs:{id:"_2、生成渲染函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、生成渲染函数"}},[t._v("#")]),t._v(" 2、生成渲染函数")]),t._v(" "),s("p",[t._v("解析完模板后,"),s("code",[t._v("Vue")]),t._v("将"),s("code",[t._v("AST")]),t._v("转换为"),s("code",[t._v("渲染函数")]),t._v("(在编译阶段就完成了)。"),s("code",[t._v("渲染函数")]),t._v("是一个"),s("code",[t._v("JavaScript函数")]),t._v("，这个渲染函数接受组件实例的状态作为参数，然后执行渲染逻辑，生成 "),s("code",[t._v("VNode")]),t._v("。")]),t._v(" "),s("p",[t._v("下面是一个简单的示例，假设我们有这样一个 "),s("code",[t._v("Vue")]),t._v(" 模板:")]),t._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("{{ message }}"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("@click")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("handleClick"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Click Me"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("编译器将会把这个模板解析为 "),s("code",[t._v("AST")]),t._v("，然后遍历 "),s("code",[t._v("AST")]),t._v(" 生成一个渲染函数：")]),t._v(" "),s("p",[t._v("这是一个打印出来的组件对象：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2024/11/01/EH4N26hicfQI8mJ.png",alt:"image-20241101115909077"}})]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("_ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回一个虚拟节点")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_openBlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_createBlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_createVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"p"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_toDisplayString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* TEXT */")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("_createVNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"button"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("onClick")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" _cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("$event")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" _ctx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleClick")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Click Me"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("上面的渲染函数中，"),s("code",[t._v("_ctx")]),t._v(" 是组件实例的上下文对象，"),s("code",[t._v("_cache")]),t._v(" 是一个缓存对象，存储了事件处理函数等。")]),t._v(" "),s("h2",{attrs:{id:"_3-挂载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-挂载"}},[t._v("#")]),t._v(" 3.挂载")]),t._v(" "),s("p",[t._v("挂载时会首次执行渲染函数，渲染函数会根据当前的渲染上下文数据生成虚拟DOM节点。")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("createElement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"div"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("innerHtml")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"456"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("上面的代码执行后，会返回 "),s("code",[t._v("vnode")]),t._v(" ，大概结构是这样的：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2024/06/28/Ja4kouvpIhcWYtN.png",alt:"image-20240628153853609"}})]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("createElement 别名 h 函数，h 函数接受三个参数：节点类型（字符串或组件）、属性对象、子节点，是 vue 提供的用于创建 vnode 的辅助函数。")])]),t._v(" "),s("h2",{attrs:{id:"diff算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#diff算法"}},[t._v("#")]),t._v(" diff算法")]),t._v(" "),s("p",[s("code",[t._v("diff")]),t._v(" 算法，也称为 “patch” 算法，是一种智能比较 Virtual DOM 的算法，旨在最小化对真实 DOM 的操作次数，提高渲染性能。")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s2.loli.net/2024/06/28/86YEX2DlvqwxdHK.png",alt:"img"}})]),t._v(" "),s("p",[s("strong",[t._v("步骤：")])]),t._v(" "),s("ol",[s("li",[t._v("节点比对：对新旧 "),s("code",[t._v("VNode")]),t._v(" 进行深度优先遍历，比较节点类型、"),s("code",[t._v("key")]),t._v("、"),s("code",[t._v("data")]),t._v(" 等，找出相同节点和需要更新的节点。")]),t._v(" "),s("li",[t._v("对比完成后，得到了需要更新、添加和删除的节点，"),s("code",[t._v("Vue")]),t._v("会将这些操作打包成一个补丁"),s("code",[t._v("（patch）")]),t._v("然后将补丁应用到真实"),s("code",[t._v("DOM")]),t._v("上，从而完成更新。")])]),t._v(" "),s("p",[s("strong",[t._v("实现：")])]),t._v(" "),s("ul",[s("li",[t._v("1、如果新旧节点是同一个节点，直接比较它们的子节点。")]),t._v(" "),s("li",[t._v("2、如果新旧节点不是同一个节点，且它们都有子节点，则使用“最长递增子序列”算法对子节点进行匹配，将不需要更新的节点复用，需要更新的节点打上标记。")]),t._v(" "),s("li",[t._v("3、如果新旧节点不是同一个节点，且旧节点没有子节点，直接用新节点替换旧节点。")]),t._v(" "),s("li",[t._v("4、如果新旧节点不是同一个节点，且新节点没有子节点，删除旧节点。")])]),t._v(" "),s("p",[s("strong",[t._v("判断是否是同一个节点")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("判断两个"),s("code",[t._v("VNode")]),t._v("节点是否是同一个节点，需要满足以下条件")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("key")]),t._v("相同")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("tag")]),t._v("（当前节点的标签名）相同")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("isComment")]),t._v("（是否为注释节点）相同")])]),t._v(" "),s("li",[s("p",[t._v("是否data（当前节点对应的对象，包含了具体的一些数据信息，是一个"),s("code",[t._v("VNodeData")]),t._v("类型，可以参考"),s("code",[t._v("VNodeData")]),t._v("类型中的数据信息）都有定义")])])]),t._v(" "),s("p",[t._v("当标签是"),s("code",[t._v("<input>")]),t._v("的时候，"),s("code",[t._v("type")]),t._v("必须相同")]),t._v(" "),s("p",[t._v(":::")]),t._v(" "),s("h4",{attrs:{id:"更新dom"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更新dom"}},[t._v("#")]),t._v(" 更新DOM")]),t._v(" "),s("p",[t._v("在"),s("code",[t._v("Vue")]),t._v("执行完渲染函数并且对比新旧的vnode树后，如果发现需要更新DOM，那么就会执行"),s("code",[t._v("patch")]),t._v("函数来完成DOM更新。")]),t._v(" "),s("p",[s("code",[t._v("patch")]),t._v("函数定义在"),s("code",[t._v("src/core/vdom/patch.js")]),t._v("中，其主要作用是比较新旧节点的差异，然后进行最小化的DOM操作，从而尽可能减少DOM操作的次数，提高渲染效率。")]),t._v(" "),s("p",[t._v("下面是patch函数的简化代码示例：")]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("patch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("oldVnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sameVnode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果新旧节点相同，执行updateChildren函数更新子节点")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateChildren")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果新旧节点不同，直接替换旧节点")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" parent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parentNode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElm")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextSibling")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldVnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldVnode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("p",[t._v("在代码示例中，"),s("code",[t._v("updateChildren")]),t._v("函数用于更新新旧节点的子节点，它的实现过程就是通过比较新旧节点的子节点，找出它们之间的差异，然后进行最小化的"),s("code",[t._v("DOM")]),t._v("操作。如果新旧节点本身不同，则直接通过"),s("code",[t._v("DOM")]),t._v("操作替换旧节点。")]),t._v(" "),s("p",[t._v("总之，"),s("code",[t._v("patch")]),t._v("函数的主要作用就是通过最小化的"),s("code",[t._v("DOM")]),t._v("操作，将新的"),s("code",[t._v("vnode")]),t._v("树渲染成真实的"),s("code",[t._v("DOM")]),t._v("树，并将其插入到"),s("code",[t._v("HTML")]),t._v("文档中。")])])}),[],!1,null,null,null);s.default=e.exports}}]);