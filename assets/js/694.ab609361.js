(window.webpackJsonp=window.webpackJsonp||[]).push([[694],{1068:function(s,a,t){"use strict";t.r(a);var n=t(5),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"什么是-monorepo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-monorepo"}},[s._v("#")]),s._v(" 什么是 Monorepo？")]),s._v(" "),a("blockquote",[a("p",[s._v("Monorepo 是一种（"),a("strong",[s._v("单仓多模块")]),s._v("）的开发模式，可以在一个代码库中管理多个项目、组件或服务，提供更好的代码共享和重用性。")])]),s._v(" "),a("p",[s._v("直至 2024 年，目前在前端界比较流行的 Monorepo 工具有 "),a("code",[s._v("Pnpm Workspaces")]),s._v("、"),a("code",[s._v("Yarn Workspaces")]),s._v("、"),a("code",[s._v("npm Workspaces")]),s._v("、"),a("code",[s._v("Rush")]),s._v("、"),a("code",[s._v("Turborepo")]),s._v("、"),a("code",[s._v("Lerna")]),s._v("、"),a("code",[s._v("Yalc")]),s._v("、和 "),a("code",[s._v("Nx")]),s._v("，它们提供了更好的管理、构建和部署多个项目的能力。")]),s._v(" "),a("p",[s._v("Pnpm 本身提供了 Monorepo 能力，不需要额外安装其他工具，所以"),a("strong",[s._v("强烈推荐使用")]),a("code",[s._v("Pnpm Workspaces")]),s._v(" "),a("strong",[s._v("作为 Monorepo 项目的依赖管理工具")]),s._v("😍😍😍。")]),s._v(" "),a("h3",{attrs:{id:"优缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优缺点"}},[s._v("#")]),s._v(" 优缺点")]),s._v(" "),a("p",[s._v("优点：")]),s._v(" "),a("ul",[a("li",[s._v("保留 multirepo 的主要优势\n"),a("ol",[a("li",[s._v("代码复用")]),s._v(" "),a("li",[s._v("模块独立管理")]),s._v(" "),a("li",[s._v("分工明确，业务场景独立")]),s._v(" "),a("li",[s._v("代码耦合度降低")])])]),s._v(" "),a("li",[s._v("管理所有项目的版本控制更加容易和一致，降低了不同项目之间的版本冲突。")]),s._v(" "),a("li",[s._v("可以统一项目的构建和部署流程，降低了配置和维护多个项目所需的工作量。")])]),s._v(" "),a("p",[s._v("缺点：")]),s._v(" "),a("ul",[a("li",[s._v("Monorepo 可能随着时间推移变得庞大和复杂，导致构建时间增长和管理困难，git clone、pull 的成本增加。")]),s._v(" "),a("li",[s._v("权限管理问题：项目粒度的权限管理较为困难，容易产生非owner管理者的改动风险。")])]),s._v(" "),a("h3",{attrs:{id:"monorepo-绝不是简单地将代码搬到一个仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#monorepo-绝不是简单地将代码搬到一个仓库"}},[s._v("#")]),s._v(" "),a("strong",[s._v("Monorepo 绝不是简单地将代码搬到一个仓库")])]),s._v(" "),a("p",[s._v("在 Monorepo 中，每个子模块仍然是独立的，有独立的版本，可以独立发包，不受其他模块的限制，最重要的是 Monorepo 的 build、test 都是增量的，只有发生更改的子模块会进行构建和测试，而不需要重新构建和测试整个代码库。这可以大大加快持续集成（CI）的速度，提高开发效率。")]),s._v(" "),a("p",[s._v("与传统多仓库项目相比，Monorepo 中的子模块可以代码共享，可以最大程度复用依赖、复用工作流、复用基础配置。")]),s._v(" "),a("p",[s._v("但是单体仓库和多仓库两种方案能同时存在，一定是各有利弊的，不要将自己锁定到一种方案上，选择最合适的才是最好的。")]),s._v(" "),a("h2",{attrs:{id:"为什么组件库项目会选用-monorepo-模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么组件库项目会选用-monorepo-模式"}},[s._v("#")]),s._v(" 为什么组件库项目会选用 Monorepo 模式")]),s._v(" "),a("p",[s._v("对于组件库项目，很自然的会涉及到划分以下模块")]),s._v(" "),a("ul",[a("li",[s._v("components 包，作为组件库的主要代码，实现各个 UI 组件的核心逻辑。")]),s._v(" "),a("li",[s._v("shared 包，主要存放各种杂七杂八的工具方法。")]),s._v(" "),a("li",[s._v("theme 包，实现组件库的主题样式定制方案。")]),s._v(" "),a("li",[s._v("cli 包，实现组件库模板脚手架的命令行工具。")]),s._v(" "),a("li",[s._v("docs 包，组件库的示例 demo 与使用文档。")]),s._v(" "),a("li",[s._v("playground 包，组件库的在线编辑、演示应用。")])]),s._v(" "),a("p",[s._v("细化拆分不同模块的好处非常明显，一句话总结就是：模块划分的越清晰，复用时的灵活性、可操作性就越强，每个独立模块产物的体积也会越轻量。")]),s._v(" "),a("h2",{attrs:{id:"基于-pnpm-包管理器的-monorepo-基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于-pnpm-包管理器的-monorepo-基本使用"}},[s._v("#")]),s._v(" 基于 pnpm 包管理器的 monorepo 基本使用")]),s._v(" "),a("h3",{attrs:{id:"创建-workspace"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-workspace"}},[s._v("#")]),s._v(" 创建 workspace")]),s._v(" "),a("p",[a("code",[s._v("pnpm")]),s._v(" 支持 "),a("code",[s._v("monorepo")]),s._v(" 模式的工作机制叫做 "),a("a",{attrs:{href:"https://pnpm.io/zh/workspaces",target:"_blank",rel:"noopener noreferrer"}},[s._v("workspace(工作空间)"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("p",[s._v("它要求在代码仓的根目录下存有 "),a("code",[s._v("pnpm-workspace.yaml")]),s._v(" 文件指定哪些目录作为独立的工作空间，这个工作空间可以理解为一个子模块或者 "),a("code",[s._v("npm")]),s._v(" 包。")]),s._v(" "),a("p",[s._v("例如以下的 "),a("code",[s._v("pnpm-workspace.yaml")]),s._v(" 文件定义："),a("code",[s._v("a")]),s._v(" 目录、"),a("code",[s._v("b")]),s._v(" 目录、"),a("code",[s._v("c")]),s._v(" 目录下的所有子目录，都会各自被视为独立的模块。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("packages:\n  - a\n  - b\n  - c/*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("📦my-project\n ┣ 📂a\n ┃ ┗ 📜package.json\n ┣ 📂b\n ┃ ┗ 📜package.json\n ┣ 📂c\n ┃ ┣ 📂c-1\n ┃ ┃ ┗ 📜package.json\n ┃ ┣ 📂c-2\n ┃ ┃ ┗ 📜package.json\n ┃ ┗ 📂c-3\n ┃   ┗ 📜package.json\n ┣ 📜package.json\n ┣ 📜pnpm-workspace.yaml\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"内部依赖管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#内部依赖管理"}},[s._v("#")]),s._v(" 内部依赖管理")]),s._v(" "),a("p",[s._v("假如项目 a 依赖项目 b :")]),s._v(" "),a("p",[s._v("可以在项目 a 中的 package.json 中建立 workspace 依赖。")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"b"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"workspace:*"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("当然，你也可以直接在根目录中管理所有 workspace 依赖：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-project"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"private"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"a"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"workspace:*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"b"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"workspace:*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"c-1"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"workspace:*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"c-2"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"workspace:*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"c-3"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"workspace:*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("在实际发布 "),a("code",[s._v("npm")]),s._v(" 包时，"),a("code",[s._v("workspace:^")]),s._v(" 会被替换成内部模块 "),a("code",[s._v("b")]),s._v(" 的对应版本号(对应 "),a("code",[s._v("package.json")]),s._v(" 中的 "),a("code",[s._v("version")]),s._v(" 字段)。替换规律如下所示：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"dependencies"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"a"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"workspace:*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 固定版本依赖，被转换成 x.x.x")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"b"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"workspace:~"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// minor 版本依赖，将被转换成 ~x.x.x")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"c"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"workspace:^"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// major 版本依赖，将被转换成 ^x.x.x")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"pnpm-filter过滤器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pnpm-filter过滤器"}},[s._v("#")]),s._v(" pnpm filter过滤器")]),s._v(" "),a("p",[s._v("如何在根目录下对指定包进行操作？")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("pnpm "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("filter a i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("D")]),s._v(" lodash  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 为 a 包安装 lodash")]),s._v("\npnpm "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("F")]),s._v(" a build "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// a 包执行build命令（-F为简写）")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);