---
stitle: release-it
date: 2024-10-30 16:38:01
permalink: /pages/releaseit
categories: 
  - æŠ€æœ¯
  - æŠ€æœ¯æ–‡æ¡£
tags: 
  - null
author: 
  name: å¤œçŒ«å­
  link: https://github.com/yemao-zi
titleTag: null
title: release-it
---

# release-it

ç”¨äºè‡ªåŠ¨æ‰§è¡Œç‰ˆæœ¬æ§åˆ¶å’Œæ‰“åŒ…å‘å¸ƒç›¸å…³ä»»åŠ¡çš„é€šç”¨ `CLI` å·¥å…·

`release-it` å®ƒåšäº†ä»€ä¹ˆï¼Ÿ

- å˜æ›´ç‰ˆæœ¬å·
- æäº¤å˜æ›´
- åˆ›å»º `git tag`
- æ¨é€åˆ†æ”¯ä¸ `tag`
- åˆ›å»º `GitHub Release`
- å‘å¸ƒåˆ° `npm`

## å¿«é€Ÿå¼€å§‹

å°† `release-it` æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œå¯é€šè¿‡ï¼š

- è‡ªåŠ¨å®‰è£…

```shell
pnpm dlx release-it init
```

- æ‰‹åŠ¨å®‰è£…

```shell
pnpm add release-it -D
```

```json
{
  "name": "my-package",
  "version": "1.0.0",
  "scripts": {
    "release": "release-it"
  },
  "devDependencies": {
    "release-it": "^15.10.0"
  }
}
```

## å¢åŠ é…ç½®

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­ä½¿ç”¨ `.release-it.json` æ–‡ä»¶ï¼Œæˆ–åœ¨ `package.json` ä¸­ä½¿ç”¨ `release-it` å±æ€§ã€‚

```json
{
  "git": {
    "commitMessage": "chore: release v${version}"
  },
  "github": {
    "release": true
  }
}
```

## Git

`release-it` å¯ä»¥è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ä»¥ `stage`, `commit`, `tag` å’Œ `push` åˆ°è¿œç¨‹ã€‚

## Changelog

- è‡ªåŠ¨å˜æ›´æ—¥å¿—

å¯¹äºæ›´ä¸°å¯Œçš„å˜æ›´æ—¥å¿—ï¼ˆä¾‹å¦‚ï¼Œå¸¦æœ‰æ ‡é¢˜ã€éƒ¨åˆ†ï¼‰

```json
{
  "git": {
    "changelog": "npx auto-changelog --stdout --commit-limit false -u --template https://raw.githubusercontent.com/release-it/release-it/main/templates/changelog-compact.hbs"
  },
  "hooks": {
    "after:bump": "npx auto-changelog -p"
  }
}
```

- å¸¸è§„å˜æ›´æ—¥å¿—

å¦‚æœé¡¹ç›®éµå¾ªçº¦å®šï¼Œä¾‹å¦‚ [Angular](https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#commits) æäº¤æŒ‡å—ï¼Œåˆ™ `@release-it/conventional-changelog` æ’ä»¶éå¸¸æœ‰ç”¨ã€‚

```sh
pnpm add @release-it/conventional-changelog -D
```

```sh
{
  "plugins": {
    "@release-it/conventional-changelog": {
      "preset": "angular",
      "infile": "CHANGELOG.md"
    }
  }
}
```

::: tip

- ä½¿ç”¨æ­¤æ’ä»¶å¯ä»¥æ ¹æ®æäº¤æ¶ˆæ¯è·å–æ¨èçš„ç‰ˆæœ¬ã€‚
- å®ƒå¯ä»¥ç”Ÿæˆå¸¸è§„çš„æ›´æ”¹æ—¥å¿—ï¼Œå¹¶å¯é€‰æ‹©åœ¨æ­¤è¿‡ç¨‹ä¸­æ›´æ–° `CHANGELOG.md` æ–‡ä»¶ã€‚

:::

- ä¿ç•™å˜æ›´æ—¥å¿—

å¦‚æœé¡¹ç›®éµå¾ª [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/) çº¦å®šï¼Œåˆ™ `@release-it/keep-a-changelog`æ’ä»¶å¾ˆæœ‰ç”¨ã€‚å®ƒæ ¹æ® **ä½¿ç”¨äººç±»å¯è¯»é¡¹ç›®**å’Œ **`Unreleased` éƒ¨åˆ†**çš„çº¦å®šæ›´æ–° `CHANGELOG.md` æ–‡ä»¶ã€‚

```shell
pnpm add @release-it/keep-a-changelog -D
```

```json
{
  "plugins": {
    "@release-it/keep-a-changelog": {
      "filename": "CHANGELOG.md"
    }
  }
}
```

### æ·»åŠ è‡ªå®šä¹‰è¯­ä¹‰

```json
{
  "github": {
    "release": true
  },
  "git": {
    "commitMessage": "release: v${version}"
  },
  "npm": {
    "publish": true
  },
  "hooks": {
    "after:bump": "echo æ›´æ–°ç‰ˆæœ¬æˆåŠŸ"
  },
  "plugins": {
    "@release-it/conventional-changelog": {
      "preset": {
        "name": "conventionalcommits",
        "types": [
          { "type": "feat", "section": "âœ¨ Features | æ–°åŠŸèƒ½" },
          { "type": "fix", "section": "ğŸ› Bug Fixes | Bug ä¿®å¤" },
          { "type": "chore", "section": "ğŸ« Chores | å…¶ä»–æ›´æ–°" },
          { "type": "docs", "section": "ğŸ“ Documentation | æ–‡æ¡£" },
          { "type": "style", "section": "ğŸ’„ Styles | é£æ ¼" },
          { "type": "refactor", "section": "â™» Code Refactoring | ä»£ç é‡æ„" },
          { "type": "perf", "section": "âš¡ Performance Improvements | æ€§èƒ½ä¼˜åŒ–" },
          { "type": "test", "section": "âœ… Tests | æµ‹è¯•" },
          { "type": "revert", "section": "âª Reverts | å›é€€" },
          { "type": "build", "section": "ğŸ‘·â€ Build System | æ„å»º" },
          { "type": "ci", "section": "ğŸ”§ Continuous Integration | CI é…ç½®" },
          { "type": "config", "section": "ğŸ”¨ CONFIG | é…ç½®" }
        ]
      },
      "infile": "CHANGELOG.md",
      "ignoreRecommendedBump": true
    }
  }
}
```

å½“ä½ æäº¤çš„ `commit` æ˜¯ä¸Šé¢å®šä¹‰çš„æäº¤è§„èŒƒå°±ä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”æ ¼å¼çš„ `changelog`

```bash
# ç¤ºä¾‹
git commit -m 'feat: æ·»åŠ ä¸€æ¡ä¿¡æ¯'
```



## é¢„å‘å¸ƒ

ä½¿ç”¨ `release-it`ï¼Œå¯ä»¥è½»æ¾åˆ›å»ºé¢„å‘å¸ƒç‰ˆæœ¬ï¼šæƒ³è¦æä¾›çš„è½¯ä»¶ç‰ˆæœ¬ï¼Œä½†å®ƒå°šæœªå¤„äºç¨³å®šçš„ semver èŒƒå›´å†…ã€‚é€šå¸¸ï¼Œ`alpha`ã€`beta` å’Œ `rc` ï¼ˆå€™é€‰ç‰ˆæœ¬ï¼‰ç”¨ä½œé¢„å‘å¸ƒçš„æ ‡è¯†ç¬¦ã€‚

ä¸€ä¸ªä¾‹å­ã€‚ç›®å‰ç‰ˆæœ¬ `awesome-pkg` ä¸º `1.3.0`ï¼Œæ–°çš„ä¸»è¦æ›´æ–°å·¥ä½œå·²å®Œæˆã€‚å‘å¸ƒæ–°ä¸»è¦ç‰ˆæœ¬çš„æœ€æ–°æµ‹è¯•ç‰ˆï¼š

```
release-it major --preRelease=beta
```

è¿™å°†æ ‡è®°å¹¶å‘å¸ƒç‰ˆæœ¬ `2.0.0-beta.0`ï¼š

- æ­£å¸¸ `npm` å®‰è£…çš„ `awesome-pkg` ä»ä¸º `1.3.0` ç‰ˆæœ¬ã€‚
- `npm` æ ‡ç­¾å°†æ˜¯ `beta`ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…å®ƒï¼š`npm install awesome-pkg@beta`
- `GitHub` ç‰ˆæœ¬å°†è¢«æ ‡è®°ä¸º `Pre-release`ã€‚

ä¸Šé¢å‘½ä»¤æ˜¯ä»¥ä¸‹å‘½ä»¤çš„ç®€å†™ï¼š

```
release-it premajor --preReleaseId=beta --npm.tag=beta --github.preRelease
```

1. è¿ç»­æµ‹è¯•ç‰ˆï¼ˆ2.0.0-beta.1ï¼‰

```
release-it --preRelease
```

2. å‘å¸ƒä¸‹ä¸€é˜¶æ®µæ—¶ï¼ˆ2.0.0-rc.0ï¼‰

```
release-it --preRelease=rc
```

3. æœ€ç»ˆç‰ˆæœ¬ï¼ˆ2.0.0ï¼‰

```shell
release-it major
```



::: tip

å½“è‡ªæœ€æ–°ä¸»è¦æ ‡è®°ä»¥æ¥çš„æ‰€æœ‰æäº¤éƒ½åº”æ·»åŠ åˆ°æ›´æ”¹æ—¥å¿—ä¸­æ—¶ï¼Œè¯·ä½¿ç”¨ `--git.tagExclude`ï¼š

```shell
release-it major --git.tagExclude='*[-]*'
```

è¿™å°†æ‰¾åˆ°æœ€æ–°çš„ `major matching tag`ï¼Œä¸åŒ…æ‹¬ `pre-release tags`ï¼Œè¿™äº›æ ‡è®°é€šå¸¸åœ¨å…¶åç§°ä¸­åŒ…å« `-` ã€‚

:::



è®©æˆ‘ä»¬å›åˆ°æœ€æ–°ç‰ˆæœ¬æ˜¯ `2.0.0-rc.0` çš„æ—¶å€™ã€‚æˆ‘ä»¬æ·»åŠ äº†æ–°åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½åœ¨ `v2` ç‰ˆæœ¬ä¸­è¿˜ä¸éœ€è¦ï¼Œè€Œæ˜¯åœ¨ä»¥åçš„ `v2.1` ç‰ˆæœ¬ä¸­ã€‚å¯ä»¥ä¸º `2.1.0-alpha.0` ä¹‹åçš„æ¬¡è¦ç‰ˆæœ¬åˆ›å»ºæ–°çš„é¢„å‘å¸ƒ `ID`ï¼š



```shell
release-it preminor --preRelease=alpha
```

ç¬”è®°ï¼š

- `pre-releases` ä¸ **æ¨èç‰ˆæœ¬** åŒæ—¶è¿›è¡Œã€‚
- æ‚¨ä»ç„¶å¯ä»¥è¦†ç›–å„ä¸ªé€‰é¡¹ï¼Œä¾‹å¦‚ `release-it --preRelease=rc --npm.tag=next`ã€‚

## npm

å¦‚æœå½“å‰ç›®å½•ä¸­æœ‰ `package.json` æ—¶ï¼Œ`release-it` å°†å…è®¸ `npm` åœ¨ `package.json` ï¼ˆä»¥åŠ `package-lock.json` ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼‰ä¸­æå‡ç‰ˆæœ¬ï¼Œå¹¶å‘å¸ƒåˆ° `npm` ä»“åº“ã€‚

- å¦‚æœåªåº”è·³è¿‡å‘å¸ƒæ­¥éª¤ï¼Œä½¿ç”¨ `npm.publishï¼šfalse`ã€‚

```json
{
  "npm": {
    "publish": false
  }
}
```

- å¦‚æœåº”è¯¥å¿½ç•¥ `package.json`ï¼Œä¸æå‡ç‰ˆæœ¬å¹¶ä¸”ä¸å°†ä»»ä½•å†…å®¹å‘å¸ƒåˆ° `npm`ï¼Œä½¿ç”¨ `--no-npm` æˆ– `"npm"ï¼šfalse`ã€‚

```json
{
  "npm": false
}
```

- è¦å¿½ç•¥ `package.json` ä¸­çš„ç‰ˆæœ¬ï¼ˆå¹¶æ”¹ç”¨æœ€æ–°çš„ `Git tag`ï¼‰ï¼Œä½¿ç”¨ `--npm.ignoreVersion` æˆ– `npm.ignoreVersionï¼štrue`

```json
{
  "npm": {
    "ignoreVersion": true
  }
}
```

## Hooks

ä½¿ç”¨ `script hooks` åœ¨å‘å¸ƒè¿‡ç¨‹ä¸­çš„ä»»ä½•æ—¶åˆ»è¿è¡Œ `shell` å‘½ä»¤ï¼ˆä¾‹å¦‚ `before:init` æˆ– `after:release`ï¼‰ã€‚

æ ¼å¼ä¸º `[prefix]:[hook]` æˆ– `[prefix]:[plugin]:[hook]`:

| part   | value                                       |
| :----- | :------------------------------------------ |
| prefix | `before` or `after`                         |
| plugin | `version`, `git`, `npm`, `github`, `gitlab` |
| hook   | `init`, `bump`, `release`                   |

```json
{
  "hooks": {
    "before:init": [
      "npm run lint",
      "npm test"
    ],
    "after:my-plugin:bump": "./bin/my-script.sh",
    "after:bump": "npm run build",
    "after:git:release": "echo After git push, before github release",
    "after:release": "echo Successfully released ${name} v${version} to ${repo.repository}."
  }
}
```

- æ’ä»¶æ‰§è¡Œé¡ºåºï¼š`init` æ–¹æ³•å…ˆæ‰§è¡Œé…ç½®çš„æ’ä»¶ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œç„¶åæ‰§è¡Œæ ¸å¿ƒæ’ä»¶ï¼š`npm` â†’ `git` â†’ `github` â†’ `gitlab` â†’ `version`
- å…¬å¼€å˜é‡ï¼šåœ¨é™¤äº† `init` ä¹‹å¤–çš„å…¶ä»– `Hooks` ä¸­å‡å¯ç”¨

```
version
latestVersion
changelog
name
repo.remote, repo.protocol, repo.host, repo.owner, repo.repository, repo.project
branchName
```

## GitHub

### è‡ªåŠ¨åŒ–æ·»åŠ releases

è¦è‡ªåŠ¨åŒ–å‘å¸ƒï¼ˆä½¿ç”¨ `GitHub REST API`ï¼‰ï¼Œéœ€è¦é…ç½®ä»¥ä¸‹å†…å®¹ï¼š

- é…ç½® `github.release: true`
- è·å¾—ä¸ªäººè®¿é—®ä»¤ç‰Œï¼ˆ`release-it` åªéœ€è¦ `repo` è®¿é—®æƒé™; ä¸éœ€è¦ `admin` æˆ–å…¶ä»–è®¿é—®æƒé™ï¼‰.
- ç¡®ä¿ä»¤ç‰Œæ˜¯å¯ç”¨çš„ç¯å¢ƒå˜é‡

### æ‰‹åŠ¨æ·»åŠ releases

è¿™ç§æ¨¡å¼ä¸‹ `release-it` å°†æ‰“å¼€æŒ‡å‘ `GitHub web` ç•Œé¢çš„é»˜è®¤æµè§ˆå™¨ï¼Œå¹¶é¢„å…ˆå¡«å……å­—æ®µï¼Œåœ¨å‘å¸ƒå‘å¸ƒä¹‹å‰ï¼Œå¯ä»¥ä¿®æ”¹æ•°æ®å¹¶ä¸Šä¼ èµ„äº§ã€‚

- é…ç½® `github.release: true`
- å½“æœªè®¾ç½® `GITHUB_TOKEN` ç¯å¢ƒå˜é‡æ—¶ï¼Œæ­¤æ¨¡å¼ä¼šè‡ªåŠ¨å¯ç”¨ã€‚
- æ˜¾å¼è®¾ç½® `github.web: true` ä»¥è¦†ç›–æ­¤ `GITHUB_TOKEN` æ£€æŸ¥ã€‚
- ä½¿ç”¨ `github.autoGenerate: true` è®© `github` ç”Ÿæˆå‘è¡Œè¯´æ˜ã€‚

### action

```yaml
jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: Git config
        run: |
          git config user.name "${GITHUB_ACTOR}"
          git config user.email "${GITHUB_ACTOR}@users.noreply.github.com"
      
      - name: Use pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8
      
      - name: Use node
        uses: actions/setup-node@v3
        with:
          node-version: 16
          cache: pnpm
      
      - name: Install dependencies
        run: pnpm install --frozen-lockfile
      
      - name: Release
        run: pnpm release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```