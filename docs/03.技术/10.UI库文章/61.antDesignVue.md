---
title: antDesignVue
date: 2023-07-20 17:41:33
permalink: /pages/825181/
categories:
  - 技术
  - UI库文章
tags:
  - 
author: 
  name: 夜猫子
  link: https://github.com/yemao-zi
titleTag: 
---

## 封装table分页

```js
import { ref, reactive } from 'vue'

export const usePagination = (options) => {
  const { searchParams, loadData, pageOptions } = options
  const list = ref([])

  const pagination = reactive({
    total: 0,
    current: 1,
    showTotal: (total) => `共 ${total} 条记录`,
    pageSize: 10,
    pageSizeOptions: ['10', '20', '30', '40', '50'],
    onChange,
    ...pageOptions
  })
  async function onChange(current, pageSize, params = searchParams) {
    pagination.current = current
    pagination.pageSize = pageSize
    if (!loadData) return
    let newSearchParams
    if (typeof params === 'function') {
      newSearchParams = params(pagination)
    } else {
      newSearchParams = params
    }
    const { data = {} } = await loadData({
      curPage: current,
      pageSize,
      ...newSearchParams
    })
    const { total, records = [] } = data
    pagination.total = total
    list.value = records
  }
  onChange(pagination.current, pagination.pageSize, searchParams)
  const search = (params = searchParams) => {
    onChange(pagination.current, pagination.pageSize, params)
  }
  return [pagination, list, search]
}

```

## 封装upload

1.attrs 属性不能被响应式监听

2.同名属性（比如 customRequest），attrs 中的属性会覆盖掉你封装的

3.props 中定义的属性不会再出现在 attrs 中

3.attrs 中不允许出现同名事件，同名事件会被合并成一个数组然后报错了：

![image-20241108165158556](https://s2.loli.net/2024/11/08/heBirJwyEHLpF1n.png)

```vue
<template>
  <a-upload
    v-bind="attrs"
    ref="componentRef"
    v-model:file-list="fileList"
    :customRequest="customUpload"
    :disabled="disabled"
    @change="handleChange"
  >
    <!-- 遍历子组件作用域插槽，并对父组件暴露 -->
    <template v-for="k in Object.keys(slots)" #[k]="slotProps" :key="k">
      <slot :name="k" v-bind="slotProps || {}">
        <v-render :content="slots[k]?.()" />
      </slot>
    </template>
  </a-upload>
</template>

<script setup lang="jsx">
// https://hj-dev.hczyun.cn/data/minio/leo/upload/20241108/475003d1441d36dd80912b9adffed9fd.jpg
import { useAttrs, useSlots, watch, defineModel, useTemplateRef } from 'vue'
import { UploadOutlined } from '@ant-design/icons-vue'
import { fileUpload } from './config'
const attrs = useAttrs()
const emits = defineEmits(['change'])
const props = defineProps({
  disabled: {
    type: Boolean,
    default: false
  }
})
const slots = {
  default: (...args) => {
    if (!props.disabled) {
      return (
        <a-button>
          <UploadOutlined></UploadOutlined>
          上传文件
        </a-button>
      )
    }
  },
  ...useSlots()
}

const fileList = defineModel('fileList', {
  default: () => []
})
const files = defineModel('files', {
  default: ''
})

watch(
  () => files,
  (newVal) => {
    if (newVal.value?.length) {
      fileList.value = newVal.value.split(',').map((v) => ({
        uid: v,
        name: v.split('/').slice(-1)[0],
        url: v
      }))
    }
  },
  {
    immediate: true
  }
)

const componentRef = useTemplateRef('componentRef')

const customUpload = async (...args) => {
  const e = args[0]
  let file = e.file
  let progress = { percent: 1 }
  let speed = 100 / (file.size / 65000)
  const intervalId = setInterval(() => {
    if (progress.percent < 100) {
      progress.percent += speed
      e.onProgress(progress)
    } else {
      clearInterval(intervalId)
    }
  }, 100)
  const formData = new FormData()
  formData.append('file', file)
  fileUpload(formData)
    .then(({ data = {} }) => {
      if (!data.link) return
      e.onSuccess({
        name: data.name,
        url: data.link
      })
    })
    .catch((err) => {
      e.onError(err)
    })
}

const handleChange = ({ file, fileList }) => {
  emits('change', { file, fileList })
  const urls = fileList.map((v) => {
    const url = v.url || v.response?.url
    return url
  })
  files.value = urls.join(',')
}
defineExpose({
  componentRef
})
</script>

<style></style>

```

