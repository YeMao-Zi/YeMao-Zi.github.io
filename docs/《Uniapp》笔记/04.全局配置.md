---
title: 全局配置
date: 2022-08-02 17:36:58
permalink: /pages/57c68b/
categories:
  - 《Uniapp》笔记
tags:
  - 
author: 
  name: 夜猫子
  link: https://github.com/zhushengjie123
titleTag: 
---
## page.json 页面和路由

`pages.json` 文件用来对 uni-app 进行全局配置，决定页面文件的路径、窗口样式、原生的导航栏、底部的原生tabbar 等。

### [#](https://uniapp.dcloud.net.cn/collocation/pages.html#配置项列表)配置项列表

| 属性                                                         | 描述                                                         |
| :----------------------------------------------------------- | :----------------------------------------------------------- |
| [globalStyle](https://uniapp.dcloud.net.cn/collocation/pages#globalstyle) | 用于设置应用的状态栏、导航条、标题、窗口背景色等             |
| [pages](https://uniapp.dcloud.net.cn/collocation/pages#pages) | 配置所有页面，包括页面路径，以及页面的状态栏、导航条、标题、窗口背景色等 |
| [easycom](https://uniapp.dcloud.net.cn/collocation/pages#easycom) | 组件自动引入规则                                             |
| [tabBar](https://uniapp.dcloud.net.cn/collocation/pages#tabbar) | 为多 tab 应用指定一级导航栏，以及 tab 切换时显示的对应页     |
| [condition](https://uniapp.dcloud.net.cn/collocation/pages#condition) | 启动模式配置，仅开发期间生效，用于模拟直达页面的场景，如：小程序转发后，用户点击所打开的页面 |
| [subPackages](https://uniapp.dcloud.net.cn/collocation/pages#subPackages) | 分包加载配置，因小程序有体积和资源加载限制，因此提供了分包加载机制 |
| [preloadRule](https://uniapp.dcloud.net.cn/collocation/pages#preloadrule) | 分包预下载规则，在进入小程序某个页面时，由框架自动预下载可能需要的分包，提升进入后续分包页面时的启动速 |
| [workers](https://developers.weixin.qq.com/miniprogram/dev/framework/workers.html) | `Worker` 代码放置的目录                                      |
| [leftWindow](https://uniapp.dcloud.net.cn/collocation/pages#leftwindow) | 大屏左侧窗口，用于解决宽屏适配问题                           |
| [topWindow](https://uniapp.dcloud.net.cn/collocation/pages#topwindow) | 大屏顶部窗口                                                 |
| [rightWindow](https://uniapp.dcloud.net.cn/collocation/pages#rightwindow) | 大屏右侧窗口                                                 |
| [uniIdRouter](https://uniapp.dcloud.net.cn/uniCloud/uni-id-summary#uni-id-router) | 自动跳转相关配置，新增于HBuilderX 3.5.0                      |

### 完整配置示例

```javascript
{
	"pages": [{
		"path": "pages/component/index",// 页面路径
		"style": {// 页面的状态栏、导航条、标题、窗口背景色等
			"navigationBarTitleText": "组件"
		}
	}, {
		"path": "pages/API/index",
		"style": {
			"navigationBarTitleText": "接口"
		}
	}, {
		"path": "pages/component/view/index",
		"style": {
			"navigationBarTitleText": "view"
		}
	}],
	"condition": { //模式配置，仅开发期间生效
		"current": 0, //当前激活的模式（list 的索引项）
		"list": [{
			"name": "test", //模式名称
			"path": "pages/component/view/index" //启动页面，必选
		}]
	},
	"globalStyle": {
		"navigationBarTextStyle": "black",
		"navigationBarTitleText": "演示",
		"navigationBarBackgroundColor": "#F8F8F8",
		"backgroundColor": "#F8F8F8",
		"usingComponents":{
			"collapse-tree-item":"/components/collapse-tree-item"
		},
		"renderingMode": "seperated", // 仅微信小程序，webrtc 无法正常时尝试强制关闭同层渲染
		"pageOrientation": "portrait", //横屏配置，全局屏幕旋转设置(仅 APP/微信/QQ小程序)，支持 auto / portrait / landscape
		"rpxCalcMaxDeviceWidth": 960,
		"rpxCalcBaseDeviceWidth": 375,
		"rpxCalcIncludeWidth": 750
	},
	"tabBar": {
		"color": "#7A7E83",
		"selectedColor": "#3cc51f",
		"borderStyle": "black",
		"backgroundColor": "#ffffff",
		"height": "50px",
		"fontSize": "10px",
		"iconWidth": "24px",
		"spacing": "3px",
    "iconfontSrc":"static/iconfont.ttf", // app tabbar 字体.ttf文件路径 app 3.4.4+
		"list": [{
			"pagePath": "pages/component/index",
			"iconPath": "static/image/icon_component.png",
			"selectedIconPath": "static/image/icon_component_HL.png",
			"text": "组件",
      "iconfont": { // 优先级高于 iconPath，该属性依赖 tabbar 根节点的 iconfontSrc
        "text": "\ue102",
        "selectedText": "\ue103",
        "fontSize": "17px",
        "color": "#000000",
        "selectedColor": "#0000ff"
      }
		}, {
			"pagePath": "pages/API/index",
			"iconPath": "static/image/icon_API.png",
			"selectedIconPath": "static/image/icon_API_HL.png",
			"text": "接口"
		}],
		"midButton": {
			"width": "80px",
			"height": "50px",
			"text": "文字",
			"iconPath": "static/image/midButton_iconPath.png",
			"iconWidth": "24px",
			"backgroundImage": "static/image/midButton_backgroundImage.png"
		}
	},
  "easycom": {
    "autoscan": true, //是否自动扫描组件
    "custom": {//自定义扫描规则
      "^uni-(.*)": "@/components/uni-$1.vue"
    }
  },
  "topWindow": {
    "path": "responsive/top-window.vue",
    "style": {
      "height": "44px"
    }
  },
  "leftWindow": {
    "path": "responsive/left-window.vue",
    "style": {
      "width": "300px"
    }
  },
  "rightWindow": {
    "path": "responsive/right-window.vue",
    "style": {
      "width": "300px"
    },
    "matchMedia": {
      "minWidth": 768
    }
  }
}
```

## manifest.json 应用的配置

用于指定应用的名称、图标、权限等。HBuilderX 中已支持可视化操作。

## package.json 平台编译扩展

uni-app 通过在`package.json`文件中增加`uni-app`扩展节点，可实现自定义条件编译平台。

扩展新的平台后，有3点影响：

1. 可以在代码里编写自定义的条件编译，为这个新平台编写专用代码
2. 运行时可以执行面向新平台的编译运行
3. 发行时可以执行面向新平台的编译发行

## uni.scss 样式预置变量

uni-app的编译器在webpack配置中特殊处理了这个uni.scss，使得每个scss文件都被注入这个uni.scss，达到全局可用的效果。

## App.vue 页面入口文件

`App.vue`是uni-app的主组件，可以调用应用生命周期函数、配置全局样式、配置全局的存储 globalData。

### 应用生命周期

> **应用生命周期仅可在`App.vue`中监听，在其它页面监听无效**。

`uni-app` 支持如下应用生命周期函数：

| 函数名               | 说明                                                         |
| :------------------- | :----------------------------------------------------------- |
| onLaunch             | 当`uni-app` 初始化完成时触发（全局只触发一次）               |
| onShow               | 当 `uni-app` 启动，或从后台进入前台显示                      |
| onHide               | 当 `uni-app` 从前台进入后台                                  |
| onError              | 当 `uni-app` 报错时触发                                      |
| onUniNViewMessage    | 对 `nvue` 页面发送的数据进行监听，可参考 [nvue 向 vue 通讯(opens new window)](https://uniapp.dcloud.io/tutorial/nvue-api?id=communication) |
| onUnhandledRejection | 对未处理的 Promise 拒绝事件监听函数（2.8.1+）                |
| onPageNotFound       | 页面不存在监听函数                                           |
| onThemeChange        | 监听系统主题变化                                             |

**示例代码**

```html
<script>
	// 只能在App.vue里监听应用的生命周期
	export default {
		onLaunch: function() {
			console.log('App Launch')
		},
		onShow: function() {
			console.log('App Show')
		},
		onHide: function() {
			console.log('App Hide')
		}
	}
</script>
```

### globalData

全局变量机制，全端通用。如果使用状态管理，请使用`vuex`（main.js中定义）。

**以下是 App.vue 中定义globalData的相关配置：**

```html
<script>  
    export default {  
        globalData: { // 直接配置
            text: 'text'  
        },
        getApp().globalData.text = 'test' // js的操作方式
    }  
</script>  
```

### 全局样式

在`App.vue`中，可以定义一些全局通用样式，例如需要加一个通用的背景色，首屏页面渲染的动画等都可以写在App.vue中。

注意如果工程下同时有vue和nvue文件，全局样式的所有css会应用于所有文件，而nvue支持的css有限，编译器会在控制台报警，提示某些css无法在nvue中支持。此时需要把nvue不支持的css写在单独的条件编译里。如：

```html
<style>
    /* #ifndef APP-PLUS-NVUE */
    @import './common/uni.css';
    /* #endif*/
</style>
```

## main.js 入口文件

主要作用是初始化`vue`实例、定义全局组件、使用需要的插件如 vuex。同 vue 中用法一致。

## plugin.json 小程序插件

#### 插件目录结构

> 编译到微信小程序插件结果

```text
plugin
├── components               // 插件提供的自定义组件（可以有多个）
│   ├── hello-component.js
│   ├── hello-component.json
│   ├── hello-component.wxml
│   └── hello-component.wxss
├── pages
│   ├── hello-page.js        // 插件提供的页面（可以有多个）
│   ├── hello-page.json
│   ├── hello-page.wxml
│   └── hello-page.wxss
├── index.js                 // 插件的 js 接口
└── plugin.json              // 插件配置文件
```

#### 插件配置文件

```json
// mp-weixin 微信小程序
{	
    // 列出所有向小程序开放的自定义组件。
	"publicComponents": {
		"hello-component": "components/hello-component"
	},
    // 列出所有向小程序开放的页面。
	"pages": {
		"hello-page": "pages/hello-page"
	},
    // 插件面向第三方小程序的 js 接口。
	"main": "index.js"
}
```

```json
// mp-alipay 阿里小程序
{
    // 列出所有向小程序开放的自定义组件。
   "publicComponents": { 
     "hello-component": "components/hello-component"
   },
    // 列出所有向小程序开放的页面。
   "publicPages": {
     "hello-pages": "pages/hello-page"
   },
    // 列出插件所有页面（包含向小程序开放的以及不向小程序开放的页面）。
   "pages": [
     "pages/hello-page"
     "pages/index"
   ],
    // 插件面向第三方小程序的 js 接口。
   "main": "index.js"
}
```

**注意**

1. `mp-weixin` 中的 `pages` 项与 `mp-alipay` 中的 `publicPages` 项作用一致
2. `mp-alipay` 中供外部使用的页面，需要在 `pages` 中声明，数组类型
3. 由于两端的格式不一致，可以在 `plugin.json` 中使用[条件编译](https://uniapp.dcloud.io/tutorial/platform.html#preprocessor)处理