---
title: 页面
date: 2022-07-26 11:41:08
permalink: /pages/b9c309/
categories:
  - 《Uniapp》笔记
tags:
  - 
author: 
  name: 夜猫子
  link: https://github.com/yemao-zi
titleTag: 
---
# 页面基础

## 目录

~~~
pages.json	-----------------------页面相关配置文件（页面路由、导航条、选项卡等页面类信息，以对象形式定义）
manifest.json-----------------------工程配置(应用名称、appid、logo、版本等打包信息)
main.js		-----------------------vue初始化入口文件
app.vue		-----------------------全局样式，监听应用生命周期等配置
static		-----------------------静态资源、图标等
pages		-----------------------页面
components	-----------------------组件
common	    -----------------------公共文件(我这里创建用来放置全局的css)
uni.scss    -----------------------这里是uni-app内置的常用样式变量
~~~

## 页面管理

> 每次页面的更改都需要在`pages.json`中配置相应的`pages`列表

### pages.json配置

pages.json 的完整配置参考官方文档：[全局文件](https://uniapp.dcloud.io/collocation/pages)。

| 属性                                                         | 类型             | 必填   | 描述                                    | 平台兼容   |
| :----------------------------------------------------------- | :--------------- | :----- | :-------------------------------------- | :--------- |
| [pages](https://uniapp.dcloud.io/collocation/pages#pages)    | Object Array类型 | 是必填 | 设置页面路径及窗口表现描述              | 平台兼容   |
| [globalStyle](https://uniapp.dcloud.io/collocation/pages#globalstyle) | Object           | 否     | 设置默认页面的窗口表现                  |            |
| [easycom](https://uniapp.dcloud.io/collocation/pages#easycom) | Object           | 否     | 组件自动引入规则                        | 2.5.5+     |
| [tabBar](https://uniapp.dcloud.io/collocation/pages#tabbar)  | Object           | 否     | 设置底部 tab 的表现                     |            |
| [condition](https://uniapp.dcloud.io/collocation/pages#condition) | Object           | 否     | 启动模式配置                            |            |
| [subPackages](https://uniapp.dcloud.io/collocation/pages#subPackages) | Object Array     | 否     | 分包加载配置                            |            |
| [preloadRule](https://uniapp.dcloud.io/collocation/pages#preloadrule) | Object           | 否     | 分包预下载规则                          | 微信小程序 |
| [workers(opens new window)](https://developers.weixin.qq.com/miniprogram/dev/framework/workers.html) | String           | 否     | `Worker` 代码放置的目录                 | 微信小程序 |
| [leftWindow](https://uniapp.dcloud.io/collocation/pages#leftwindow) | Object           | 否     | 大屏左侧窗口                            | H5         |
| [topWindow](https://uniapp.dcloud.io/collocation/pages#topwindow) | Object           | 否     | 大屏顶部窗口                            | H5         |
| [rightWindow](https://uniapp.dcloud.io/collocation/pages#rightwindow) | Object           | 否     | 大屏右侧窗口                            | H5         |
| [uniIdRouter](https://uniapp.dcloud.io/uniCloud/uni-id-summary#uni-id-router) | Object           | 否     | 自动跳转相关配置，新增于HBuilderX 3.5.0 |            |

注：建议使用 HBuilderX 开发，HBuilderX 会自动在`pages.json`中完成页面注册，无需手动配置。

首页：`pages.json -> pages`配置项中的第一个页面，作为当前工程的首页（启动页）。

### 页面可调用 API

####  getApp()

获取当前应用实例

~~~js
const app = getApp()
getApp().globalData.name=“王二麻子” // 一般用来设置和读写全局变量
~~~

#### getCurrentPages()

函数用于仅用于获取当前页面栈的实例（不要用来修改页面栈），其以数组形式按栈的顺序输出，第一个元素为首页，最后一个元素为当前页面。

~~~js
getCurrentPages().pop(); //当前页面
page.route // 获取当前页面 route
page.$getAppWebview() // 获取当前页面的webview对象实例,实现对 webview 更强大的控制(仅限App)
~~~

### 页面通讯

#### uni.$emit(eventName,OBJECT)

触发全局的自定义事件。附加参数都会传给监听器回调。

~~~js
uni.$emit('update',{msg:'页面更新'})
~~~

#### uni.$on(eventName,callback)

监听全局的自定义事件。事件可以由 uni.$emit 触发，回调函数会接收所有传入事件触发函数的额外参数。

~~~js
uni.$on('update',function(data){
		console.log('监听到事件来自 update ，携带参数 msg 为：' + data.msg);
	})
~~~

#### uni.$once(eventName,callback)

与 uni.$on 用法一样，区别在于 uni.$once 只触发一次。

#### uni.$off([eventName, callback])

移除全局自定义事件监听器(移除 uni.$on)。

- 如果没有提供参数，则移除所有的事件监听器；

- 如果只提供了事件，则移除该事件所有的监听器；

- 如果同时提供了事件与回调，则只移除这个回调的监听器；

- 提供的回调必须跟$on的回调为同一个才能移除这个回调的监听器；

```js
uni.$off('add', this.add)
```

### 页面栈

uniApp 通过栈的形式管理所有的页面，路由切换时，实质是引起栈的改变。

| 路由方式   | 页面栈表现                        | 触发时机                                                     |
| ---------- | --------------------------------- | ------------------------------------------------------------ |
| 初始化     | 新页面入栈                        | uni-app 打开的第一个页面                                     |
| 打开新页面 | 新页面入栈                        | 调用 API  [uni.navigateTo](https://uniapp.dcloud.net.cn/api/router#navigateto) 、使用组件[<navigator open-type="navigate"/>](https://uniapp.dcloud.net.cn/component/navigator?id=navigator) |
| 页面重定向 | 当前页面出栈，新页面入栈          | 调用 API  [uni.redirectTo](https://uniapp.dcloud.net.cn/api/router#redirectto) 、使用组件 [<navigator open-type="redirectTo"/>](https://uniapp.dcloud.net.cn/component/navigator?id=navigator) |
| 页面返回   | 页面不断出栈，直到目标返回页      | 调用 API  [uni.navigateBack](https://uniapp.dcloud.net.cn/api/router#navigateback)  、使用组件 [<navigator open-type="navigateBack"/>](https://uniapp.dcloud.net.cn/component/navigator?id=navigator) 、用户按左上角返回按钮、安卓用户点击物理back按键 |
| Tab 切换   | 页面全部出栈，只留下新的 Tab 页面 | 调用 API  [uni.switchTab](https://uniapp.dcloud.net.cn/api/router#switchtab) 、使用组件 [<navigator open-type="switchTab"/>](https://uniapp.dcloud.net.cn/component/navigator?id=navigator) 、用户切换 Tab |
| 重加载     | 页面全部出栈，只留下新的页面      | 调用 API  [uni.reLaunch](https://uniapp.dcloud.net.cn/api/router#relaunch) 、使用组件  [<navigator open-type="reLaunch"/>](https://uniapp.dcloud.net.cn/component/navigator?id=navigator) |

## 路由管理

### 路由配置

- 默认是在 [pages.json](https://uniapp.dcloud.io/collocation/pages#pages) 里配置每个路由页面的路径及页面样式。

- 如果希望采用 `Vue Router` 方式管理路由，在插件市场中下载 [Vue-Router](https://ext.dcloud.net.cn/search?q=vue-router)。

### 路由跳转

#### navigator组件跳转

类似于 a 标签，但只能跳转本地页面，目标页面需要在 page.json 中注册。

```html
<navigator url="navigate/navigate?title=navigate" hover-class="navigator-hover">
	<button type="default">跳转到新页面</button>
</navigator>
```

#### 调用API跳转

##### uni.navigateTo(OBJECT)

保留当前页面，跳转到应用内的某个页面，还可以使用`uni.navigateBack`可以返回到原页面。

因为会保留页面，所以不能进行无限制的跳转。

```javascript
uni.navigateTo({
    // 在起始页面跳转到test.vue页面并传递参数
	url: 'test?id=1&name=uniapp',
    // 页面间通信接口
    events: {
    // 为指定事件添加一个监听器，获取被打开页面传送到当前页面的数据
    sendToTest: function(data) {
      console.log(data)
    	}
    },
    // 成功的回调
    success: function(res) {
    // 通过eventChannel向被打开页面传送数据
    res.eventChannel.emit('sendToTest', { data: 'data from starter page' })
  }
});
```

```javascript
// 在test.vue页面接受参数
export default {
	onLoad: function (option) { //option为object类型，会序列化上个页面传递的参数
		console.log(option.id,option.name); //打印出上个页面传递的参数。
         const eventChannel = this.$scope.eventChannel; // eventChannel 页面间事件通讯通道 
         eventChannel.emit('sendToTest', {data: 'data from test page'});// 通过sendToTest监听器 传输数据
       	 eventChannel.on('sendToTest', function(data) {// 监听 sendToTest , 获取数据
    		console.log(data)
  		})
	}
}
```

##### uni.redirectTo(OBJECT)

关闭当前页面，并跳转到应用内的某个页面。

~~~js
uni.redirectTo({
	url: 'test?id=1'
});
~~~

##### uni.reLaunch(OBJECT)

关闭所有页面，打开到应用内的某个页面。

~~~js
uni.reLaunch({
	url: 'test?id=1'
});
~~~

##### uni.switchTab(OBJECT)

跳转到 tabBar 页面，并关闭其他所有非 tabBar 页面。

~~~js
// other.vue
uni.switchTab({
	url: '/pages/index/index'
})
~~~

~~~js
// pages.json
{
  "tabBar": {
    "list": [{
      "pagePath": "pages/index/index",
      "text": "首页"
    },{
      "pagePath": "pages/other/other",
      "text": "其他"
    }]
  }
}
~~~

##### uni.navigateBack(OBJECT)

关闭当前页面，返回上一页面或多级页面。可通过 `getCurrentPages()` 获取当前的页面栈，决定需要返回几层。

一般和 `uni.navigateTo()` 一起使用。

~~~js
// 注意：调用 navigateTo 跳转时，调用该方法的页面会被加入堆栈，而 redirectTo 方法则不会。见下方示例代码
// 此处是A页面=>B页面
uni.navigateTo({
	url: 'B?id=1'
});
// 此处是B页面=>C页面
uni.navigateTo({
	url: 'C?id=1'
});
// 在C页面内通过 navigateBack 返回两层，将返回A页面
uni.navigateBack({
	delta: 2
});
~~~

##### EventChannel

页面间事件通信通道，可以通过其进行页面通讯。

~~~ts
EventChannel.emit(string eventName, any args)
EventChannel.emit(string eventName, any args)
EventChannel.emit(string eventName, any args)
EventChannel.emit(string eventName, any args)
~~~

#####  uni.preloadPage(OBJECT)

页面预加载技术，仅支持 App 和 H5。

~~~js
uni.preloadPage({url: "/pages/test/test"});
~~~

##### 窗口动画

适用的路由 API

- navigateTo
- navigateBack

仅支持 App。

```javascript
uni.navigateTo({
	url: '../test/test',
	animationType: 'pop-in',
	animationDuration: 200
});
uni.navigateBack({
	delta: 1,
	animationType: 'pop-out',
	animationDuration: 200
});
```

## 生命周期

### 组件生命周期

| 函数名        | 说明                                                         | 平台差异说明 |
| :------------ | :----------------------------------------------------------- | :----------- |
| beforeCreate  | 在实例初始化之前被调用。[详见(opens new window)](https://cn.vuejs.org/v2/api/#beforeCreate) |              |
| created       | 在实例创建完成后被立即调用。[详见(opens new window)](https://cn.vuejs.org/v2/api/#created) |              |
| beforeMount   | 在挂载开始之前被调用。[详见(opens new window)](https://cn.vuejs.org/v2/api/#beforeMount) |              |
| mounted       | 挂载到实例上去之后调用。[详见 (opens new window)](https://cn.vuejs.org/v2/api/#mounted)注意：此处并不能确定子组件被全部挂载，如果需要子组件完全挂载之后在执行操作可以使用`$nextTick`[Vue官方文档(opens new window)](https://cn.vuejs.org/v2/api/#Vue-nextTick) |              |
| beforeUpdate  | 数据更新时调用，发生在虚拟 DOM 打补丁之前。[详见(opens new window)](https://cn.vuejs.org/v2/api/#beforeUpdate) | 仅H5平台支持 |
| updated       | 由于数据更改导致的虚拟 DOM 重新渲染和打补丁，在这之后会调用该钩子。[详见(opens new window)](https://cn.vuejs.org/v2/api/#updated) | 仅H5平台支持 |
| beforeDestroy | 实例销毁之前调用。在这一步，实例仍然完全可用。[详见(opens new window)](https://cn.vuejs.org/v2/api/#beforeDestroy) |              |
| destroyed     | Vue 实例销毁后调用。调用后，Vue 实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。[详见(opens new window)](https://cn.vuejs.org/v2/api/#destroyed) |              |

### 页面生命周期

| 函数名                              | 说明                                                         | 平台差异说明                                                 | 最低版本 |
| :---------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- | :------- |
| onInit                              | 监听页面初始化，其参数同 onLoad 参数，为上个页面传递的数据，参数类型为 Object（用于页面传参），触发时机早于 onLoad | 百度小程序                                                   | 3.1.0+   |
| onLoad                              | 监听页面加载，其参数为上个页面传递的数据，参数类型为 Object（用于页面传参），参考[示例](https://uniapp.dcloud.io/api/router#navigateto) |                                                              |          |
| onShow                              | 监听页面显示。页面每次出现在屏幕上都触发，包括从下级页面点返回露出当前页面 |                                                              |          |
| onReady                             | 监听页面初次渲染完成。注意如果渲染速度快，会在页面进入动画完成前触发 |                                                              |          |
| onHide                              | 监听页面隐藏                                                 |                                                              |          |
| onUnload                            | 监听页面卸载                                                 |                                                              |          |
| onResize                            | 监听窗口尺寸变化                                             | App、微信小程序、快手小程序                                  |          |
| onPullDownRefresh                   | 监听用户下拉动作，一般用于下拉刷新，参考[示例](https://uniapp.dcloud.io/api/ui/pulldown) |                                                              |          |
| onReachBottom                       | 页面滚动到底部的事件（不是scroll-view滚到底），常用于下拉下一页数据。具体见下方注意事项 |                                                              |          |
| onTabItemTap                        | 点击 tab 时触发，参数为Object，具体见下方注意事项            | 微信小程序、QQ小程序、支付宝小程序、百度小程序、H5、App、快手小程序、京东小程序 |          |
| onShareAppMessage                   | 用户点击右上角分享                                           | 微信小程序、QQ小程序、支付宝小程序、字节小程序、飞书小程序、快手小程序、京东小程序 |          |
| onPageScroll                        | 监听页面滚动，参数为Object                                   | nvue暂不支持                                                 |          |
| onNavigationBarButtonTap            | 监听原生标题栏按钮点击事件，参数为Object                     | App、H5                                                      |          |
| onBackPress                         | 监听页面返回，返回 event = {from:backbutton、 navigateBack} ，backbutton 表示来源是左上角返回按钮或 android 返回键；navigateBack表示来源是 uni.navigateBack ；详细说明及使用：[onBackPress 详解 (opens new window)](http://ask.dcloud.net.cn/article/35120)。支付宝小程序只有真机能触发，只能监听非navigateBack引起的返回，不可阻止默认行为。 | app、H5、支付宝小程序                                        |          |
| onNavigationBarSearchInputChanged   | 监听原生标题栏搜索输入框输入内容变化事件                     | App、H5                                                      | 1.6.0    |
| onNavigationBarSearchInputConfirmed | 监听原生标题栏搜索输入框搜索事件，用户点击软键盘上的“搜索”按钮时触发。 | App、H5                                                      | 1.6.0    |
| onNavigationBarSearchInputClicked   | 监听原生标题栏搜索输入框点击事件（pages.json 中的 searchInput 配置 disabled 为 true 时才会触发） | App、H5                                                      | 1.6.0    |
| onShareTimeline                     | 监听用户点击右上角转发到朋友圈                               | 微信小程序                                                   | 2.8.1+   |
| onAddToFavorites                    | 监听用户点击右上角收藏                                       | 微信小程序                                                   | 2.8.1+   |

`onInit`使用注意：不依赖页面传参的逻辑建议直接使用 created 生命周期替代，且尽量避免重复执行相同逻辑。

`onReachBottom`使用注意：可在pages.json里定义具体页面底部的触发距离[onReachBottomDistance](https://uniapp.dcloud.io/collocation/pages#globalstyle)，比如设为50，那么滚动页面到距离底部50px时，就会触发onReachBottom事件。（scroll-view导致的滚动不会触发该事件）

`onPageScroll` （监听滚动、滚动监听、滚动事件）参数说明：

| 属性      | 类型   | 说明                                 |
| --------- | ------ | ------------------------------------ |
| scrollTop | Number | 页面在垂直方向已滚动的距离（单位px） |

`onTabItemTap` 返回的json对象说明：

| 属性     | 类型   | 说明                         |
| -------- | ------ | ---------------------------- |
| index    | String | 被点击tabItem的序号，从0开始 |
| pagePath | String | 被点击tabItem的页面路径      |
| text     | String | 被点击tabItem的按钮文字      |

注意：onTabItemTap常用于点击当前tabitem，滚动或刷新当前页面。如果是点击不同的tabitem，一定会触发页面切换。

`onNavigationBarButtonTap` 参数说明：

| 属性  | 类型   | 说明                     |
| ----- | ------ | ------------------------ |
| index | Number | 原生标题栏按钮数组的下标 |

`onNavigationBarButtonTap` 参数说明：

| 属性  | 类型   | 说明                     |
| ----- | ------ | ------------------------ |
| index | Number | 原生标题栏按钮数组的下标 |

## 遇到的坑

1.`.vue`文件会使用 webview 进行渲染，`.nvue`会使用原生进行渲染，性能更好，但`.nvue`调试巨麻烦不推荐，一般情况下如果是 app 且有部分场景 vue 页面的性能不满足你的需求时，这个页面可以改用 nvue 页面。

2.`uniapp`中的有些组件和配置在各个端是有差异，不兼容的。

3.目前小程序方面对 grid 布局语法不太支持，建议都使用 flex 布局。

4.使用 v-for 循环时，多次使用 index 为 key 关键字时，会报错。

5.小程序不支持 `:key="'xxx'+index"` 这种运算。

6.分包时，图片等静态资源只能获取到当前分包和主包的资源。

7.虽然 uniapp 会自动注册全局组件，但仅限主包的 components 文件夹，分包也不可以。

