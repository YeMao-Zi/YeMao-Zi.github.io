---
title: 对象缓存
date: 2020-02-29 15:07:47
permalink: /pages/dxhc22212
categories: 
  - 前端
  - JavaScript文章
tags: 
  - null
titleTag: null
author: 
  name: 夜猫子
  link: https://github.com/yemao-zi
---

```js
const getSessionStorage = (itemName) => {
  return JSON.parse(sessionStorage.getItem(itemName) || '""');
};

const setSessionStorage = (itemName, value) => {
  sessionStorage.setItem(itemName, JSON.stringify(value));
};

export const usePersist = (key, data, options) => {
  const { set, get } = options || {};
  if (data.constructor !== Object) {
    return data;
  }
  let defaultData = {
    ...data,
  };

  Object.freeze(defaultData);

  const store = {
    ...defaultData,
    ...getSessionStorage(key),
  };

  const proxyData = new Proxy(store, {
    set(o, p, v, r) {
      set && set(o, p, v, r);
      if (v !== Reflect.get(store, p)) {
        setSessionStorage(key, {
          ...store,
          [p]: v,
        });
        return Reflect.set(o, p, v, r);
      } else {
        return Reflect.set(o, p, store[p], r);
      }
    },
    get(target, key) {
      get && get(target, key);
      if (key === "__proto__") {
        return undefined;
      }
      return target[key];
    },
  });

  return proxyData;
};

```

