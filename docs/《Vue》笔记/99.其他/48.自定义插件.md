---
title: 自定义插件
date: 2022-04-13 22:17:25
permalink: /pages/696bdb/
categories: 
  - 《Vue》笔记
  - 其他
tags: 
  - null
author: 
  name: 夜猫子
  link: https://github.com/zhushengjie123
titleTag: 
---
## 对外暴露一个install方法

暴露了一个 `install` 方法。其第一个参数是vue，第二个参数是自定义传参（可选的选项对象）

```javascript
let MyPlugin={}
MyPlugin.install = function (Vue, options) {
  // 1. 添加全局方法或 property
  Vue.myGlobalMethod = function () {
    // 逻辑...
  }

  // 2. 添加全局资源
  Vue.directive('my-directive', {//自定义指令
    bind (el, binding, vnode, oldVnode) {
      // 逻辑...
    }
    ...
  })

  // 3. 注入组件选项
  Vue.mixin({
    created: function () {
      // 逻辑...
    }
    ...
  })

  // 4. 添加实例方法
  Vue.prototype.$myMethod = function (methodOptions) {
    // 逻辑...
  }
}
export default MyPlugin
```

## 全局引入后注册（也可以传入一个可选的选项对象）

```javascript
Vue.use(MyPlugin, { options: '一个插件' })
```

## 相关

使用方法四直接挂载到原型上，虽然所有的实例都能访问到，但有一个风险：即同时也可以通过访问来修改该方法，存在风险，不严谨。  

可以使用js原生方法Object.defineProperty()方法代替

## 封装echarts插件案例

~~~javascript
import echarts from "echarts"
let MyPlugin = {}
MyPlugin.install = function (Vue) {
    Object.defineProperties(Vue.prototype, {
        //$myChart即为实例上添加的一个方法名
        $myChart: {
            //此处只用到get()没有用set()因为不涉及修改和双向绑定
            get() {
                return {
                    //绘制折线图
                    line(id) {
                        //以下来自echarts折线图官方配置
                        // 基于准备好的dom，初始化echarts实例
                        var myChart = echarts.init(document.getElementById(id))
                        // 指定图表的配置项和数据
                        var option = {
                            title: {
                                text: "ECharts 入门示例",
                            },
                            tooltip: {},
                            legend: {
                                data: ["销量"],
                            },
                            xAxis: {
                                data: ["衬衫", "羊毛衫", "雪纺衫", "裤子", "高跟鞋", "袜子"],
                            },
                            yAxis: {},
                            series: [
                                {
                                    name: "销量",
                                    type: "bar",
                                    data: [5, 20, 36, 10, 10, 20],
                                },
                            ],
                        };
                        // 使用刚指定的配置项和数据显示图表。
                        myChart.setOption(option);
                    },
                    //绘制地图
                    chinaMap(){
					...
                    }
                }
            }
        }
    })
}
export default MyPlugin
~~~

在main.js中use后，在任意组件中使用以下代码即表示使用折线图（折线图的相关样式规范参考echarts官网）

~~~javascript
this.$myChart.line('main')
~~~

