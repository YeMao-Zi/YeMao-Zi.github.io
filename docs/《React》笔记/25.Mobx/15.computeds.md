---
title: computeds
date: 2023-09-05 10:42:52
permalink: /pages/f11d2c/
categories:
  - ã€ŠReactã€‹ç¬”è®°
  - Mobx
tags:
  - 
author: 
  name: å¤œçŒ«å­
  link: https://github.com/yemao-zi
titleTag: 
---
# è®¡ç®—å±æ€§

åŸºäº state äºŒæ¬¡å¤„ç†æ•°æ®ã€‚

æ ‡è¯†ï¼šcomputedï¼Œæˆ–ä½¿ç”¨ makeAutoObservable è‡ªåŠ¨å°†æ‰€æœ‰çš„ getters æ ‡è¯†ä¸º computedã€‚

<!-- more -->

## ç¤ºä¾‹

ä¸‹é¢çš„ç¤ºä¾‹ä¾é  [Reactions {ğŸš€}](https://www.mobxjs.com/reactions) é«˜çº§éƒ¨åˆ†ä¸­çš„ [`autorun`](https://www.mobxjs.com/reactions#autorun) æ¥è¾…åŠ©è¯´æ˜è®¡ç®—å€¼çš„æ„ä¹‰ã€‚

```javascript
import { makeObservable, observable, computed, autorun } from "mobx"

class OrderLine {
    price = 0
    amount = 1

    constructor(price) {
        makeObservable(this, {
            price: observable,
            amount: observable,
            total: computed
        })
        this.price = price
    }

    get total() {
        console.log("Computing...")
        return this.price * this.amount
    }
}

const order = new OrderLine(0)

const stop = autorun(() => {
    console.log("Total: " + order.total)
})
// Computing...
// Total: 0

console.log(order.total)
// (ä¸ä¼šé‡æ–°è®¡ç®—!)
// 0

order.amount = 5
// Computing...
// (æ— éœ€ autorun)

order.price = 2
// Computing...
// Total: 10

stop()

order.price = 3
// è®¡ç®—å€¼å’Œ autorun éƒ½ä¸ä¼šè¢«é‡æ–°è®¡ç®—.
```

![computed graph](https://www.mobxjs.com/assets/images/computed-example-f6f76f3516441f19d6208484044a58a0.png)

## æœ€ä½³å®è·µ

1. å®ƒä»¬ä¸åº”è¯¥æœ‰å‰¯ä½œç”¨æˆ–è€…æ›´æ–°å…¶ä»–å¯è§‚å¯Ÿå¯¹è±¡ã€‚
2. é¿å…åˆ›å»ºå’Œè¿”å›æ–°çš„å¯è§‚å¯Ÿå¯¹è±¡ã€‚
3. å®ƒä»¬ä¸åº”è¯¥ä¾èµ–éå¯è§‚å¯Ÿå¯¹è±¡çš„å€¼

## Options {:rocket:}

### `name`

è¯¥å­—ç¬¦ä¸²åœ¨ [Spy event listeners](https://www.mobxjs.com/analyzing-reactivity#spy) å’Œ [MobX developer tools](https://github.com/mobxjs/mobx-devtools) ä¸­ç”¨ä½œè°ƒè¯•åç§°ã€‚

### `equals`

é»˜è®¤è®¾ç½®ä¸º `comparer.default`ã€‚å®ƒå……å½“ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ï¼Œç”¨äºæ¯”è¾ƒä¸Šä¸€ä¸ªå€¼å’Œä¸‹ä¸€ä¸ªå€¼ã€‚å¦‚æœè¯¥å‡½æ•°è®¤ä¸ºä¸¤ä¸ªå€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆè§‚å¯Ÿè€…ä»¬å°†ä¸ä¼šè¢«é‡æ–°è®¡ç®—ã€‚

#### å†…ç½® comparers

MobX æä¾›äº†å››ç§å†…ç½®çš„ `comparer` æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æ»¡è¶³ `computed` çš„ `equals` é€‰é¡¹çš„å¤§å¤šæ•°éœ€æ±‚ï¼š

- `comparer.identity` ä½¿ç”¨å…¨ç­‰ ï¼ˆ`===`ï¼‰è¿ç®—ç¬¦ç¡®å®šä¸¤ä¸ªå€¼æ˜¯å¦ç›¸åŒã€‚
- `comparer.default` ä¸ `comparer.identity` ç›¸åŒï¼Œä½†æ˜¯å…¶è®¤ä¸º `NaN` ç­‰äº `NaN`ã€‚
- `comparer.structural` æ‰§è¡Œæ·±å±‚çš„ç»“æ„æ¯”è¾ƒä»¥ç¡®å®šä¸¤ä¸ªå€¼æ˜¯å¦ç›¸åŒã€‚
- `comparer.shallow` æ‰§è¡Œæµ…å±‚çš„ç»“æ„æ¯”è¾ƒä»¥ç¡®å®šä¸¤ä¸ªå€¼æ˜¯å¦ç›¸åŒã€‚

#### ç¤ºä¾‹ç»“æ„æ¯”è¾ƒ{:eyes:}

å½“è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡æ—¶ï¼Œå³æ—¶å€¼ä¸€æ ·ï¼Œè§‚å¯Ÿè€…ä»¬ä¹Ÿä¼šé»˜è®¤æ•°æ®ä¸ä¸€æ ·ï¼Œå¹¶ä¼šè§¦å‘ç›‘å¯Ÿè€…ã€‚

å¦‚æœéœ€è¦è¿›è¡Œç»“æ„æ¯”è¾ƒå¯ä»¥ä½¿ç”¨ `computed.struct`ã€‚

::: details ç‚¹å‡»æŸ¥çœ‹ä»£ç 

```tsx
class Box {
    width = 0
    height = 0

    constructor() {
        makeObsevable(this, {
            x: observable,
            y: observable,
            topRight: computed({equals:'structural'})
        })
    }

    get topRight() {
        return {
            x: this.width,
            y: this.height
        }
    }
}
```

:::

### `keepAlive`

ä½¿è®¡ç®—å±æ€§çš„å€¼åœ¨æœªè¢«è§‚å¯Ÿæ—¶è¢«æš‚æ—¶åœç”¨ã€‚